<!DOCTYPE html>
<!-- saved from url=(0048)http://buildnewgames.com/introduction-to-crafty/ -->
<html lang="en" class="article"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>An introduction to the Crafty game engine - Build New Games</title>
  <meta name="author" content="Bocoup">
  
  <meta name="description" content="An Introduction to the Crafty Game Engine Feb 1st, 2013 | by Darren Torpey .gist { max-height: none; } .gist .gist-file { margin: 3em 0; } …">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
  
  <link rel="canonical" href="http://buildnewgames.com/introduction-to-crafty">
  <link href="http://buildnewgames.com/favicon.png" rel="icon">

  <link href="./An introduction to the Crafty game engine - Build New Games_files/reset.css" media="screen, projection" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="http://buildnewgames.com/introduction-to-crafty/assets/css/factory.css">

  <!--[if (gt IE 8)|!(IE)]><!-->
    <link href="./An introduction to the Crafty game engine - Build New Games_files/fonts.css" media="screen, projection" rel="stylesheet" type="text/css">
  <!--<![endif]-->
  <link href="./An introduction to the Crafty game engine - Build New Games_files/base.css" media="screen, projection" rel="stylesheet" type="text/css">
  
  <!-- 
  <link href="/assets/css/screen-small.css" media="screen and (max-width: 480px)" rel="stylesheet" type="text/css">
  <link href="/assets/css/screen-medium.css" media="screen and (min-width: 481px)" rel="stylesheet" type="text/css">
  <link href="/assets/css/screen-large.css" media="screen and (min-width: 1024px)" rel="stylesheet" type="text/css">
  <link href="/assets/css/screen-horizontally-small.css" rel="stylesheet" type="text/css">
   -->
  <link href="./An introduction to the Crafty game engine - Build New Games_files/screen-medium.css" rel="stylesheet" type="text/css">

  <link href="http://buildnewgames.com/atom.xml" rel="alternate" title="Build New Games" type="application/atom+xml">

  <!--[if lt IE 9]>
    <script src="/js/lib/respond.min.js"></script>
  <![endif]-->
<style type="text/css"></style><script src="./An introduction to the Crafty game engine - Build New Games_files/cb=gapi.loaded_1" async=""></script><script src="./An introduction to the Crafty game engine - Build New Games_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./An introduction to the Crafty game engine - Build New Games_files/ga.js"></script><script type="text/javascript" async="" src="./An introduction to the Crafty game engine - Build New Games_files/plusone.js" gapi_processed="true"></script><script id="facebook-jssdk" src="./An introduction to the Crafty game engine - Build New Games_files/all.js"></script><script type="text/javascript" async="" src="./An introduction to the Crafty game engine - Build New Games_files/embed.js"></script><script type="text/javascript" async="" src="./An introduction to the Crafty game engine - Build New Games_files/widgets.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,.fb_connect_bar_container span,.fb_connect_bar_container a,.fb_connect_bar_container img,.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}.fb_connect_bar a:hover{color:#fff}.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}.fb_connect_bar div a,.fb_connect_bar span,.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fbpluginrecommendationsbarleft,.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}.fbpluginrecommendationsbarleft{left:10px}.fbpluginrecommendationsbarright{right:10px}</style></head>


<body class="clearfix " data-twttr-rendered="true" cz-shortcut-listen="true">

  <banner>

    <header id="header">
  
  <a href="http://buildnewgames.com/" class="bng-logo"> 
    <img src="./An introduction to the Crafty game engine - Build New Games_files/bng-logo.png" alt="BNG">
  </a>

  <nav class="large-nav">
    <ul>
      <li><a href="http://buildnewgames.com/articles/">Articles</a></li>
      <li><a href="http://buildnewgames.com/authors/">Authors</a></li>
      <li><a href="http://buildnewgames.com/about/">About</a></li>
    </ul>
  </nav>

  <div class="home-page-info">
    <h1><a href="http://buildnewgames.com/">Build New Games</a></h1>
    <p>Open Web techniques for cutting-edge game development</p>
  </div>

</header>

    

  </banner>

  

  

    <aside class="category-list medium">
  <h2>Topics</h2>
  <ul>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/design/">Design</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/engines/">Engines</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/graphics/">Graphics</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/javascript/">JavaScript</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/mobile/">Mobile</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/multiplayer/">Multiplayer</a></li>
    <li><a class="category" href="http://buildnewgames.com/blog/categories/platform/">Platform</a></li>
    
  </ul>
  <div class="advertisement">
    <script type="text/javascript" async="" src="http://static.adzerk.net/ados.js"></script><script>var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script>
  var ados = ados || {};
  ados.run = ados.run || [];
  ados.run.push(function() {
    /* load placement for account: Bocoup, site: Build New Games, size: 120x90 - Button 1 and Text*/
    ados_add_placement(4433, 27614, "azk63887", 1);
    ados_load();
  });
</script>
<div id="azk63887"></div>
<span class="fine">Ads by <a href="http://bocoup.com/">Bocoup</a></span>
  </div>
</aside>

  


  
    <section id="main" class="article">
      <article>
  
    <header>
      
        <h1 class="entry-title">An Introduction to the Crafty Game Engine</h1>
      
      
        <p class="meta">
          








  


<time datetime="2013-02-01T12:00:00-05:00" pubdate="" data-updated="true">Feb 1<span>st</span>, 2013</time>
           | by <a href="http://www.darrentorpey.com/">Darren Torpey</a>
        </p>
      
    </header>

  
  
  
    <div class="entry-content"><style>
  .gist {
    max-height: none;
  }
  .gist .gist-file {
    margin: 3em 0;
  }
</style>

<h2 id="introduction">Introduction</h2>

<p>When building an HTML5-based game from start to finish, it is helpful to have a consistent structure for your code and common design patterns to follow when organizing your code. A good game engine helps with this and also save you a lot of time by providing already-written, tested, and proven code to meet common needs such as basic control schemes. As your game grows in size and complexity you’ll be doubly glad that you built it up using common structural patterns. Plus, by using an engine that dozens or hundreds of other developers are using you can tap into an engaged and supportive community to help you along your way.</p>

<p><a href="http://craftyjs.com/">Crafty</a>, previously known as CraftyJS, is a small, simple, and lightweight game engine that can greatly help you build prototypal or fully-featured 2D HTML5 games. Crafty is also open-source and completely free. Its code is <a href="https://github.com/craftyjs/Crafty">hosted openly on GitHub.com</a> and is distributed under the MIT or GPL license.</p>

<p>In this tutorial, I’ll show you how Crafty makes it easy to make simple, 2D games and I’ll walk you through the process of making a very simple game from start to finish. By the end of the tutorial, you’ll know how to start making your own games from scratch using Crafty and you’ll have our example game built and running in your own development environment which will give you a great jumping-off point for future projects.</p>

<h3 id="what-is-crafty">What is Crafty?</h3>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/crafty_logo.png" alt="Crafty Logo"></p>

<p>Crafty is a cohesive collection of custom-built Javascript libraries that provide a framework for building browser-based games using standard web technology. In other words, it’s a Javascript-based HTML5 game engine. It’s designed to make it very easy to make simple games with 2D graphics. Think of Crafty’s utilities as the glue that binds the pieces of your game together.</p>

<h3 id="why-crafty">Why Crafty?</h3>

<p>Crafty strikes a fine balance between doing too much and too little for you. It will help you get your games running in very short time but will get out of your way as you dive into the nitty-gritty parts of the engine and customize behavior. Crafty is also very lightweight in terms of file size, weighing in at around 100kb. That means it’s small enough that it won’t significantly delay your game’s startup time.</p>

<p>You might ask why you need an engine at all. Strictly speaking, you don’t; you could build an entire game from scratch and this can sometimes be a good idea for especially unconventional games. However, for most games having an engine is invaluable in reducing the development time and making the game more maintainable over time. Using Crafty, you can build a simple game in a matter of day and weeks, sometimes even a mere few hours.</p>

<h2 id="the-makeup-of-a-crafty-game">The makeup of a Crafty game</h2>

<p>Before we start building a game, I’d like to explain at a high level how the major pieces fit together in a typical Crafty game. I won’t go through every feature of Crafty here. Instead, I’ll focus on the most important ones that make up the core building blocks of a typical Crafty game.</p>

<h3 id="components--entities">Components &amp; entities</h3>

<p>The two most important structural elements of a Crafty game are <em>components</em> and <em>entities</em>. An <em>entity</em> is any object that exists in your game world and has behavior of any kind within it, even if that behavior is just that it takes up visual space. Everything you see on the screen in a Crafty game that is not a background image is probably an entity. A <em>component</em> specifies a set of data and/or behaviors that can be applied to one or more entities. Components can also require that the entities they’re applied to also apply <em>other</em> components. This means that a component can represent compound behavior that itself uses in part the behavior given by other components.</p>

<p>Components can be used to describe all kinds of behaviors. As I’ll show you later, many of Crafty’s build-in utilities are accessed via components.</p>

<h3 id="publishsubscribe-event-system">Publish/subscribe event system</h3>

<p>Another of Crafty’s most important utilities is it’s publish/subscribe event system. Crafty allows you to “subscribe” any number of callback functions to a given event. Those functions are then called whenever that event is fired by some other code. The beauty of this code is that the subscribers to events and the the areas of code that trigger the events do not have to explicitly know anything about each other or each other’s existence.</p>

<h3 id="scenes">Scenes</h3>

<p>Scenes are how you setup transitions from one distinct part of your Crafty game to another. For example, once we have a loading screen, game over screen, victory screen, and main gameplay screen in our game, each of these will be defined by a Scene object through Crafty.</p>

<h2 id="lets-make-a-game-piece-by-piece">Let’s make a game, piece by piece</h2>

<blockquote>
  <p>A NOTE ON VERSIONS: To follow this tutorial you must use Crafty version <strong>0.5.3</strong>. At the end of the tutorial, I’ll show you how to update the code to work with version 0.6.1, but you must use version <strong>0.5.3</strong> while following along with the tutorial.</p>
</blockquote>

<p>Now that I’ve shown you the main elements of a Crafty game to give you a high-level view of how the pieces all fit together, let’s apply that knowledge and have some fun building a game with Crafty. We’ll build a minimally-featured adventure-style game where the goal is to run around and visit all the villages in a forest.</p>

<p>We’ll build the game up slowly, piece by piece, learning more about Crafty’s many helpful utilities as we go along. In each section, I’ll first describe what we are adding to the game and why we’re adding it. Then I’ll walk you through the steps required to make those improvements. Finally, I’ll provide the exact code changes for those improvements. By the end of the tutorial, you’ll have a fully-functional game and will know how to handle many common game mechanics such as collision detection, sound effects, and movement controls.</p>

<h3 id="references-resources-and-additional-help">References, resources, and additional help</h3>

<p>As we go through the steps of building our game, whenever you wish you dive deeper or learn more about how a given part of Crafty works, I encourage you to take a look through Crafty’s <a href="http://craftyjs.com/api/">official API documention</a>. If you’re really stuck or have a more open-ended question about Crafty, check out the <a href="https://groups.google.com/forum/#!forum/craftyjs">official community forum</a>.</p>

<h3 id="hello-crafty">Hello, Crafty</h3>

<p>To start, we’ll create one of the simplest “games” one can make in Crafty. In fact, it’s so simple that at this point the “game” won’t even be interactive. The purpose is to show you how little code it takes to have a nominal Crafty program up and running and to help you get your working environment setup so that the next steps are easier for you to follow.</p>

<p>First, let’s set up a simple file directory structure to help us separate the logically distinct parts of our program. Inside our root directory, we’ll start with:</p>

<ul>
  <li><em>index.html</em> - This is the HTML file that the browser renders in order to play our game</li>
  <li><em>assets/</em> - a directory where all the media files and other binary data for our game will live</li>
  <li><em>lib/</em> - a directory where we’ll put the third-party JS files (typically called libraries, hence the abbreviated, standard name, “lib”) that we’ll use to create our game</li>
  <li><em>src/</em> - a directory where we’ll put our custom code (called “source” code for historical reasons, hence the abbreviated, standard name “src”)</li>
</ul>

<p>Once your directories are in place, download the Crafty library file and put it in <em>lib</em> directory. For this tutorial, we’ll use Crafty version 0.5.3, which you can grab here: <a href="http://craftyjs.com/release/0.5.3/crafty.js">http://craftyjs.com/release/0.5.3/crafty.js</a></p>

<p>Next, download all the image and audio assets you’ll need as we build our game from <a href="http://buildnewgames.com/assets/article//introduction-to-crafty/crafty_bng_tut_assets.zip">this archive here</a> and open the archive on your computer. Once you’ve downloaded those assets and opened the archive, move all the files in the “crafty_bng_tut_assets” directory in the archive into your <em>assets/</em> directory that you just created. All the assets in the archive are free to use. <a href="http://buildnewgames.com/assets/article//introduction-to-crafty/game/ASSET_README.html">See here for attribution and licensing details</a></p>

<p>Here are our two starting files, <em>index.html</em> and <em>src/game.js</em>:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/97cf877649697ae3ea18.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4264326" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC3">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC5">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">320</span><span class="p">);</span></div><div class="line" id="file-game-js-LC6">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'green'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC7">  <span class="p">}</span></div><div class="line" id="file-game-js-LC8"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/97cf877649697ae3ea18/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/97cf877649697ae3ea18#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-index-html-L1" rel="file-index-html-L1">1</span>
            <span class="line-number" id="file-index-html-L2" rel="file-index-html-L2">2</span>
            <span class="line-number" id="file-index-html-L3" rel="file-index-html-L3">3</span>
            <span class="line-number" id="file-index-html-L4" rel="file-index-html-L4">4</span>
            <span class="line-number" id="file-index-html-L5" rel="file-index-html-L5">5</span>
            <span class="line-number" id="file-index-html-L6" rel="file-index-html-L6">6</span>
            <span class="line-number" id="file-index-html-L7" rel="file-index-html-L7">7</span>
            <span class="line-number" id="file-index-html-L8" rel="file-index-html-L8">8</span>
            <span class="line-number" id="file-index-html-L9" rel="file-index-html-L9">9</span>
            <span class="line-number" id="file-index-html-L10" rel="file-index-html-L10">10</span>
            <span class="line-number" id="file-index-html-L11" rel="file-index-html-L11">11</span>
            <span class="line-number" id="file-index-html-L12" rel="file-index-html-L12">12</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-index-html-LC1"><span class="cp">&lt;!DOCTYPE html&gt;</span></div><div class="line" id="file-index-html-LC2"><span class="nt">&lt;html&gt;</span></div><div class="line" id="file-index-html-LC3"><span class="nt">&lt;head&gt;</span></div><div class="line" id="file-index-html-LC4">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"lib/crafty.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC5">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/game.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC6">  <span class="nt">&lt;script&gt;</span></div><div class="line" id="file-index-html-LC7">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span></div><div class="line" id="file-index-html-LC8">  <span class="nt">&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC9"><span class="nt">&lt;/head&gt;</span></div><div class="line" id="file-index-html-LC10"><span class="nt">&lt;body&gt;</span></div><div class="line" id="file-index-html-LC11"><span class="nt">&lt;/body&gt;</span></div><div class="line" id="file-index-html-LC12"><span class="nt">&lt;/html&gt;</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/97cf877649697ae3ea18/raw/index.html" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/97cf877649697ae3ea18#file-index-html">index.html</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>The HTML file, <em>index.html</em>, that gets our game going in the browser, is very simple. It simply imports the Crafty game library file, <em>crafty.js</em>, followed by our custom code file, <em>game.js</em>, in which we’ll put the code to set up <em>our</em> unique Crafty game. Finally, a single line of Javascript tells the browser to run the <em>Game.start</em> function once the page is fully loaded.</p>

<p>The <em>src/game.js</em> file itself simply defines a globally-accessible <em>Game</em> object with a single function, <em>start</em>, that initializes and starts our Crafty “game”. For now, we simply draw a plain green background so that we have obvious visual proof that our code is working.</p>

<p>Open the <em>index.html</em> file in a browser and you should see:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_1a.png" alt="Screenshot"></p>

<h3 id="starting-with-basic-terrain">Starting with basic terrain</h3>

<p>So far, we have a green box that proves we have successfully loaded Crafty and told the browser to run our game code when the page loads. Now let’s use Crafty to draw something more tangible to the screen. We’ll start by drawing a simple forest scene to the screen.</p>

<p>While the visual outcome of this step will be very humble, it allows us to get our hands dirty with one of Crafty’s most important concepts: its component/entity model. As I described in the introduction to this tutorial, a Crafty component is an abstract description of a set of properties and/or behaviors that can be applied to one or more Crafty entities.</p>

<p>Crafty itself comes with dozens of baked-in components that are automatically made available to you by the engine. These built-in components make many simple game elements easy to implement, at least as a simple first pass. This means that we can start building some basic terrain pieces by constructing entities that use some baked-in components.</p>

<p>To keep things simple to start, let’s create some terrain by placing a tree at every edge square on our grid and then randomly placing bushes on squares in between the edges. Before we do this, it will help us to have a consistent concept of a grid on which we place our entities as we develop our game. With that grid in place, we can iterate through all the tiles in our grid and place entities in those tiles as we go along. Here is our new <em>game.js</em> file. Read through the code and follow along with the comments to see how the code defines and utilizes our new grid:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/157d538de2245865db97.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4381850" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
            <span class="line-number" id="file-game-js-L23" rel="file-game-js-L23">23</span>
            <span class="line-number" id="file-game-js-L24" rel="file-game-js-L24">24</span>
            <span class="line-number" id="file-game-js-L25" rel="file-game-js-L25">25</span>
            <span class="line-number" id="file-game-js-L26" rel="file-game-js-L26">26</span>
            <span class="line-number" id="file-game-js-L27" rel="file-game-js-L27">27</span>
            <span class="line-number" id="file-game-js-L28" rel="file-game-js-L28">28</span>
            <span class="line-number" id="file-game-js-L29" rel="file-game-js-L29">29</span>
            <span class="line-number" id="file-game-js-L30" rel="file-game-js-L30">30</span>
            <span class="line-number" id="file-game-js-L31" rel="file-game-js-L31">31</span>
            <span class="line-number" id="file-game-js-L32" rel="file-game-js-L32">32</span>
            <span class="line-number" id="file-game-js-L33" rel="file-game-js-L33">33</span>
            <span class="line-number" id="file-game-js-L34" rel="file-game-js-L34">34</span>
            <span class="line-number" id="file-game-js-L35" rel="file-game-js-L35">35</span>
            <span class="line-number" id="file-game-js-L36" rel="file-game-js-L36">36</span>
            <span class="line-number" id="file-game-js-L37" rel="file-game-js-L37">37</span>
            <span class="line-number" id="file-game-js-L38" rel="file-game-js-L38">38</span>
            <span class="line-number" id="file-game-js-L39" rel="file-game-js-L39">39</span>
            <span class="line-number" id="file-game-js-L40" rel="file-game-js-L40">40</span>
            <span class="line-number" id="file-game-js-L41" rel="file-game-js-L41">41</span>
            <span class="line-number" id="file-game-js-L42" rel="file-game-js-L42">42</span>
            <span class="line-number" id="file-game-js-L43" rel="file-game-js-L43">43</span>
            <span class="line-number" id="file-game-js-L44" rel="file-game-js-L44">44</span>
            <span class="line-number" id="file-game-js-L45" rel="file-game-js-L45">45</span>
            <span class="line-number" id="file-game-js-L46" rel="file-game-js-L46">46</span>
            <span class="line-number" id="file-game-js-L47" rel="file-game-js-L47">47</span>
            <span class="line-number" id="file-game-js-L48" rel="file-game-js-L48">48</span>
            <span class="line-number" id="file-game-js-L49" rel="file-game-js-L49">49</span>
            <span class="line-number" id="file-game-js-L50" rel="file-game-js-L50">50</span>
            <span class="line-number" id="file-game-js-L51" rel="file-game-js-L51">51</span>
            <span class="line-number" id="file-game-js-L52" rel="file-game-js-L52">52</span>
            <span class="line-number" id="file-game-js-L53" rel="file-game-js-L53">53</span>
            <span class="line-number" id="file-game-js-L54" rel="file-game-js-L54">54</span>
            <span class="line-number" id="file-game-js-L55" rel="file-game-js-L55">55</span>
            <span class="line-number" id="file-game-js-L56" rel="file-game-js-L56">56</span>
            <span class="line-number" id="file-game-js-L57" rel="file-game-js-L57">57</span>
            <span class="line-number" id="file-game-js-L58" rel="file-game-js-L58">58</span>
            <span class="line-number" id="file-game-js-L59" rel="file-game-js-L59">59</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// This defines our grid's size and the size of each of its tiles</span></div><div class="line" id="file-game-js-LC3">  <span class="nx">map_grid</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">    <span class="nx">width</span><span class="o">:</span>  <span class="mi">24</span><span class="p">,</span></div><div class="line" id="file-game-js-LC5">    <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC6">    <span class="nx">tile</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC7">      <span class="nx">width</span><span class="o">:</span>  <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC8">      <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span></div><div class="line" id="file-game-js-LC9">    <span class="p">}</span></div><div class="line" id="file-game-js-LC10">  <span class="p">},</span></div><div class="line" id="file-game-js-LC11"> </div><div class="line" id="file-game-js-LC12">  <span class="c1">// The total width of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC13">  <span class="c1">//  this is just the width of a tile times the width of the grid</span></div><div class="line" id="file-game-js-LC14">  <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC15">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class="line" id="file-game-js-LC16">  <span class="p">},</span></div><div class="line" id="file-game-js-LC17"> </div><div class="line" id="file-game-js-LC18">  <span class="c1">// The total height of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC19">  <span class="c1">//  this is just the height of a tile times the height of the grid</span></div><div class="line" id="file-game-js-LC20">  <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC21">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class="line" id="file-game-js-LC22">  <span class="p">},</span></div><div class="line" id="file-game-js-LC23"> </div><div class="line" id="file-game-js-LC24">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC25">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC26">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC27">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC28">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(249, 223, 125)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC29"> </div><div class="line" id="file-game-js-LC30">    <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-game-js-LC31">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC32">      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC33">        <span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-game-js-LC34"> </div><div class="line" id="file-game-js-LC35">        <span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC36">          <span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-game-js-LC37">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, Canvas, Color'</span><span class="p">)</span></div><div class="line" id="file-game-js-LC38">            <span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-game-js-LC39">              <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-game-js-LC40">              <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span></div><div class="line" id="file-game-js-LC41">              <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-game-js-LC42">              <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-game-js-LC43">            <span class="p">})</span></div><div class="line" id="file-game-js-LC44">            <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC45">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC46">          <span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-game-js-LC47">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, Canvas, Color'</span><span class="p">)</span></div><div class="line" id="file-game-js-LC48">            <span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-game-js-LC49">              <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-game-js-LC50">              <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span></div><div class="line" id="file-game-js-LC51">              <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-game-js-LC52">              <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-game-js-LC53">            <span class="p">})</span></div><div class="line" id="file-game-js-LC54">            <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 185, 40)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC55">        <span class="p">}</span></div><div class="line" id="file-game-js-LC56">      <span class="p">}</span></div><div class="line" id="file-game-js-LC57">    <span class="p">}</span></div><div class="line" id="file-game-js-LC58">  <span class="p">}</span></div><div class="line" id="file-game-js-LC59"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/157d538de2245865db97/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/157d538de2245865db97#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p><em>“Crafty.e(‘2D, Canvas, Color’)”</em> creates a new entity that uses three components: “2D”, “Canvas”, and “Color”. The <em>2D</em> component allows us to set an x and y position (cartesian coordinates) for our entity as well as a height and width for the object. The <em>Canvas</em> component causes the entity to be drawn on the Canvas DOM element that displays our game. The <em>Color</em> component allows us to set the color that this entity is drawn as.</p>

<h3 id="reusing-common-properties-and-behavior-via-custom-components">Reusing common properties and behavior via custom components</h3>

<p>To clean up our code, we’ll create our own components that multiple entities can reuse. Let’s start by defining a “Tree” component that encapsulates the fact that a tree is a 2D, canvas-drawn, colored entity with a specific location on our grid.</p>

<p>Since we’ll be defining many components in the process of making our game, we’ll make a new source file inside of the <em>src</em> directory named <em>components.js</em>. Here is our new “Tree” component definition in that file:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/6f1c9327c6df5a332e07.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4382530" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// The Grid component allows an element to be located</span></div><div class="line" id="file-components-js-LC2"><span class="c1">//  on a grid of tiles</span></div><div class="line" id="file-components-js-LC3"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Grid'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC4">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">    <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-components-js-LC6">      <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-components-js-LC7">      <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-components-js-LC8">    <span class="p">})</span></div><div class="line" id="file-components-js-LC9">  <span class="p">},</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11">  <span class="c1">// Locate this entity at the given position on the grid</span></div><div class="line" id="file-components-js-LC12">  <span class="nx">at</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">      <span class="k">return</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">}</span></div><div class="line" id="file-components-js-LC15">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC16">      <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">});</span></div><div class="line" id="file-components-js-LC17">      <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC18">    <span class="p">}</span></div><div class="line" id="file-components-js-LC19">  <span class="p">}</span></div><div class="line" id="file-components-js-LC20"><span class="p">});</span></div><div class="line" id="file-components-js-LC21">&nbsp;</div><div class="line" id="file-components-js-LC22"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC23">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC24">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid, Color'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC25">    <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC26">  <span class="p">},</span></div><div class="line" id="file-components-js-LC27"><span class="p">});</span></div><div class="line" id="file-components-js-LC28">&nbsp;</div><div class="line" id="file-components-js-LC29"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC30">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC31">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid, Color'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC32">    <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 185, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC33">  <span class="p">},</span></div><div class="line" id="file-components-js-LC34"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/6f1c9327c6df5a332e07/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/6f1c9327c6df5a332e07#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>We can encapsulate even more common behavior to make our code more obvious by creating component named “Actor”. An “Actor” will be a component that encapsulates the use of the <em>2D</em>, <em>Canvas</em>, and <em>Grid</em> components. This allows us to simplify our <em>components.js</em> file as so:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/22628b4d92c223eb4ebf.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4382648" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
            <span class="line-number" id="file-components-js-L44" rel="file-components-js-L44">44</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// The Grid component allows an element to be located</span></div><div class="line" id="file-components-js-LC2"><span class="c1">//  on a grid of tiles</span></div><div class="line" id="file-components-js-LC3"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Grid'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC4">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">    <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-components-js-LC6">      <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-components-js-LC7">      <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-components-js-LC8">    <span class="p">})</span></div><div class="line" id="file-components-js-LC9">  <span class="p">},</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11">  <span class="c1">// Locate this entity at the given position on the grid</span></div><div class="line" id="file-components-js-LC12">  <span class="nx">at</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">      <span class="k">return</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">}</span></div><div class="line" id="file-components-js-LC15">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC16">      <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">});</span></div><div class="line" id="file-components-js-LC17">      <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC18">    <span class="p">}</span></div><div class="line" id="file-components-js-LC19">  <span class="p">}</span></div><div class="line" id="file-components-js-LC20"><span class="p">});</span></div><div class="line" id="file-components-js-LC21">&nbsp;</div><div class="line" id="file-components-js-LC22"><span class="c1">// An "Actor" is an entity that is drawn in 2D on canvas</span></div><div class="line" id="file-components-js-LC23"><span class="c1">//  via our logical coordinate grid</span></div><div class="line" id="file-components-js-LC24"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Actor'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC25">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC26">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC27">  <span class="p">},</span></div><div class="line" id="file-components-js-LC28"><span class="p">});</span></div><div class="line" id="file-components-js-LC29">&nbsp;</div><div class="line" id="file-components-js-LC30"><span class="c1">// A Tree is just an Actor with a certain color</span></div><div class="line" id="file-components-js-LC31"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC32">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC33">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC34">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC35">  <span class="p">},</span></div><div class="line" id="file-components-js-LC36"><span class="p">});</span></div><div class="line" id="file-components-js-LC37">&nbsp;</div><div class="line" id="file-components-js-LC38"><span class="c1">// A Bush is just an Actor with a certain color</span></div><div class="line" id="file-components-js-LC39"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC40">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC41">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC42">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 185, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC43">  <span class="p">},</span></div><div class="line" id="file-components-js-LC44"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/22628b4d92c223eb4ebf/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/22628b4d92c223eb4ebf#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>Of course, we need to include <em>src/components.js</em> in our <em>index.html</em> file, as seen in the following code:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/ecc1c9f9e69ddba80e7f.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4550600" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-index-html-L1" rel="file-index-html-L1">1</span>
            <span class="line-number" id="file-index-html-L2" rel="file-index-html-L2">2</span>
            <span class="line-number" id="file-index-html-L3" rel="file-index-html-L3">3</span>
            <span class="line-number" id="file-index-html-L4" rel="file-index-html-L4">4</span>
            <span class="line-number" id="file-index-html-L5" rel="file-index-html-L5">5</span>
            <span class="line-number" id="file-index-html-L6" rel="file-index-html-L6">6</span>
            <span class="line-number" id="file-index-html-L7" rel="file-index-html-L7">7</span>
            <span class="line-number" id="file-index-html-L8" rel="file-index-html-L8">8</span>
            <span class="line-number" id="file-index-html-L9" rel="file-index-html-L9">9</span>
            <span class="line-number" id="file-index-html-L10" rel="file-index-html-L10">10</span>
            <span class="line-number" id="file-index-html-L11" rel="file-index-html-L11">11</span>
            <span class="line-number" id="file-index-html-L12" rel="file-index-html-L12">12</span>
            <span class="line-number" id="file-index-html-L13" rel="file-index-html-L13">13</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-index-html-LC1"><span class="cp">&lt;!DOCTYPE html&gt;</span></div><div class="line" id="file-index-html-LC2"><span class="nt">&lt;html&gt;</span></div><div class="line" id="file-index-html-LC3"><span class="nt">&lt;head&gt;</span></div><div class="line" id="file-index-html-LC4">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"lib/crafty.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC5">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/game.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC6">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/components.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC7">  <span class="nt">&lt;script&gt;</span></div><div class="line" id="file-index-html-LC8">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span></div><div class="line" id="file-index-html-LC9">  <span class="nt">&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC10"><span class="nt">&lt;/head&gt;</span></div><div class="line" id="file-index-html-LC11"><span class="nt">&lt;body&gt;</span></div><div class="line" id="file-index-html-LC12"><span class="nt">&lt;/body&gt;</span></div><div class="line" id="file-index-html-LC13"><span class="nt">&lt;/html&gt;</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/ecc1c9f9e69ddba80e7f/raw/index.html" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/ecc1c9f9e69ddba80e7f#file-index-html">index.html</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>And finally, our <em>game.js</em> file is now much simpler because instead of defining all the properties of each entity inline, it simply references the components we just created:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/e467758c3a29489073c5.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4550681" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
            <span class="line-number" id="file-game-js-L23" rel="file-game-js-L23">23</span>
            <span class="line-number" id="file-game-js-L24" rel="file-game-js-L24">24</span>
            <span class="line-number" id="file-game-js-L25" rel="file-game-js-L25">25</span>
            <span class="line-number" id="file-game-js-L26" rel="file-game-js-L26">26</span>
            <span class="line-number" id="file-game-js-L27" rel="file-game-js-L27">27</span>
            <span class="line-number" id="file-game-js-L28" rel="file-game-js-L28">28</span>
            <span class="line-number" id="file-game-js-L29" rel="file-game-js-L29">29</span>
            <span class="line-number" id="file-game-js-L30" rel="file-game-js-L30">30</span>
            <span class="line-number" id="file-game-js-L31" rel="file-game-js-L31">31</span>
            <span class="line-number" id="file-game-js-L32" rel="file-game-js-L32">32</span>
            <span class="line-number" id="file-game-js-L33" rel="file-game-js-L33">33</span>
            <span class="line-number" id="file-game-js-L34" rel="file-game-js-L34">34</span>
            <span class="line-number" id="file-game-js-L35" rel="file-game-js-L35">35</span>
            <span class="line-number" id="file-game-js-L36" rel="file-game-js-L36">36</span>
            <span class="line-number" id="file-game-js-L37" rel="file-game-js-L37">37</span>
            <span class="line-number" id="file-game-js-L38" rel="file-game-js-L38">38</span>
            <span class="line-number" id="file-game-js-L39" rel="file-game-js-L39">39</span>
            <span class="line-number" id="file-game-js-L40" rel="file-game-js-L40">40</span>
            <span class="line-number" id="file-game-js-L41" rel="file-game-js-L41">41</span>
            <span class="line-number" id="file-game-js-L42" rel="file-game-js-L42">42</span>
            <span class="line-number" id="file-game-js-L43" rel="file-game-js-L43">43</span>
            <span class="line-number" id="file-game-js-L44" rel="file-game-js-L44">44</span>
            <span class="line-number" id="file-game-js-L45" rel="file-game-js-L45">45</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// This defines our grid's size and the size of each of its tiles</span></div><div class="line" id="file-game-js-LC3">  <span class="nx">map_grid</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">    <span class="nx">width</span><span class="o">:</span>  <span class="mi">24</span><span class="p">,</span></div><div class="line" id="file-game-js-LC5">    <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC6">    <span class="nx">tile</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC7">      <span class="nx">width</span><span class="o">:</span>  <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC8">      <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span></div><div class="line" id="file-game-js-LC9">    <span class="p">}</span></div><div class="line" id="file-game-js-LC10">  <span class="p">},</span></div><div class="line" id="file-game-js-LC11">&nbsp;</div><div class="line" id="file-game-js-LC12">  <span class="c1">// The total width of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC13">  <span class="c1">//  this is just the width of a tile times the width of the grid</span></div><div class="line" id="file-game-js-LC14">  <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC15">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class="line" id="file-game-js-LC16">  <span class="p">},</span></div><div class="line" id="file-game-js-LC17">&nbsp;</div><div class="line" id="file-game-js-LC18">  <span class="c1">// The total height of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC19">  <span class="c1">//  this is just the height of a tile times the height of the grid</span></div><div class="line" id="file-game-js-LC20">  <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC21">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class="line" id="file-game-js-LC22">  <span class="p">},</span></div><div class="line" id="file-game-js-LC23">&nbsp;</div><div class="line" id="file-game-js-LC24">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC25">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC26">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC27">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC28">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(249, 223, 125)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC29">&nbsp;</div><div class="line" id="file-game-js-LC30">    <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-game-js-LC31">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC32">      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC33">        <span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-game-js-LC34">&nbsp;</div><div class="line" id="file-game-js-LC35">        <span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC36">          <span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-game-js-LC37">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-game-js-LC38">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC39">          <span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-game-js-LC40">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-game-js-LC41">        <span class="p">}</span></div><div class="line" id="file-game-js-LC42">      <span class="p">}</span></div><div class="line" id="file-game-js-LC43">    <span class="p">}</span></div><div class="line" id="file-game-js-LC44">  <span class="p">}</span></div><div class="line" id="file-game-js-LC45"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/e467758c3a29489073c5/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/e467758c3a29489073c5#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>This gives us this on our screen:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_part_2a_1.png" alt="Screenshot"></p>

<h3 id="adding-a-player-controlled-avatar">Adding a player-controlled avatar</h3>

<p>Our Crafty “game” now shows a discernable scene, but we have to way to <strong>play</strong> it! So next, let’s add an entity that the player can control. This way at least I can stop putting quotes around “game” whenever I’m referring to about our little program.</p>

<p>To do this, we’ll define a new component named <em>PlayerCharacter</em> (we’ll call her PC for short). The PC component will require the <em>Actor</em>, <em>Fourway</em>, and <em>Color</em> components. We’ve used <em>Actor</em> and <em>Color</em> before but <em>Fourway</em> is new. <em>Fourway</em> is a very handy component that allows an entity to have it’s movement controlled by one of two four-direction control sets: W, A, S, and D or the Up, Left, Down, and Right keys.</p>

<p>All we have to activate this four-way control scheme for our player character entity is to add the <em>Fourway</em> component to it and then call the <em>fourway()</em> function on the entity to set the speed at which it should move.</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/ece4aaf170f0af7ff233.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4383797" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC6">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Color'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC7">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div><div class="line" id="file-components-js-LC8">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 75, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC9">  <span class="p">}</span></div><div class="line" id="file-components-js-LC10"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/ece4aaf170f0af7ff233/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/ece4aaf170f0af7ff233#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// ...</span></div><div class="line" id="file-game-js-LC3">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC4">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC5">    <span class="c1">// Start crafty and set a background color so that we can see</span></div><div class="line" id="file-game-js-LC6">    <span class="c1">//  it's working</span></div><div class="line" id="file-game-js-LC7">    <span class="c1">//...</span></div><div class="line" id="file-game-js-LC8">&nbsp;</div><div class="line" id="file-game-js-LC9">    <span class="c1">// Player character, placed at 5, 5 on our grid</span></div><div class="line" id="file-game-js-LC10">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></div><div class="line" id="file-game-js-LC11">&nbsp;</div><div class="line" id="file-game-js-LC12">    <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-game-js-LC13">    <span class="c1">//...</span></div><div class="line" id="file-game-js-LC14">  <span class="p">}</span></div><div class="line" id="file-game-js-LC15"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/ece4aaf170f0af7ff233/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/ece4aaf170f0af7ff233#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>Here’s what our game looks like now:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_3a.png" alt="Screenshot"></p>

<h3 id="adding-collision-between-player-character-and-terrain">Adding collision between player character and terrain</h3>

<p>Now that we can move around in our game, let’s require some more thought and attention from the player by making it so that they must navigate around terrain objects. To do this, we’ll make PC collide with and be unable to move through the bushes and trees in the game.</p>

<p>There are only three simple steps to doing this. First we’ll add the <em>Solid</em> component to our <em>Tree</em> and <em>Bush</em> components so that we can later detect they they are a kind of component that cannot be moved through by the PC entity. Second, we’ll add the <em>Collision</em> component to the <em>PlayerCharacter</em> component which gives us some built-in code (which we’ll use in the very next step) to help us detect when the PC has collided with a <em>Solid</em> entity. Finally, we’ll write a function to handle such collisions and register the function to be called whenever a collision occurs.</p>

<p>Here are the additions to our code needed:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/b587b0ccb27a93b5b1ce.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4446438" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
            <span class="line-number" id="file-components-js-L44" rel="file-components-js-L44">44</span>
            <span class="line-number" id="file-components-js-L45" rel="file-components-js-L45">45</span>
            <span class="line-number" id="file-components-js-L46" rel="file-components-js-L46">46</span>
            <span class="line-number" id="file-components-js-L47" rel="file-components-js-L47">47</span>
            <span class="line-number" id="file-components-js-L48" rel="file-components-js-L48">48</span>
            <span class="line-number" id="file-components-js-L49" rel="file-components-js-L49">49</span>
            <span class="line-number" id="file-components-js-L50" rel="file-components-js-L50">50</span>
            <span class="line-number" id="file-components-js-L51" rel="file-components-js-L51">51</span>
            <span class="line-number" id="file-components-js-L52" rel="file-components-js-L52">52</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3"><span class="c1">// An "Actor" is an entity that is drawn in 2D on canvas</span></div><div class="line" id="file-components-js-LC4"><span class="c1">//  via our logical coordinate grid</span></div><div class="line" id="file-components-js-LC5"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Actor'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC6">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC7">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC8">  <span class="p">},</span></div><div class="line" id="file-components-js-LC9"><span class="p">});</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11"><span class="c1">// A Tree is just an Actor with a certain color</span></div><div class="line" id="file-components-js-LC12"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color, Solid'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC15">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC16">  <span class="p">},</span></div><div class="line" id="file-components-js-LC17"><span class="p">});</span></div><div class="line" id="file-components-js-LC18">&nbsp;</div><div class="line" id="file-components-js-LC19"><span class="c1">// A Bush is just an Actor with a certain color</span></div><div class="line" id="file-components-js-LC20"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC21">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC22">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color, Solid'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC23">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 185, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC24">  <span class="p">},</span></div><div class="line" id="file-components-js-LC25"><span class="p">});</span></div><div class="line" id="file-components-js-LC26">&nbsp;</div><div class="line" id="file-components-js-LC27"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC28"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC29">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC30">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Color, Collision'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC31">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div><div class="line" id="file-components-js-LC32">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 75, 40)'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC33">      <span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">();</span></div><div class="line" id="file-components-js-LC34">  <span class="p">},</span></div><div class="line" id="file-components-js-LC35">&nbsp;</div><div class="line" id="file-components-js-LC36">  <span class="c1">// Registers a stop-movement function to be called when</span></div><div class="line" id="file-components-js-LC37">  <span class="c1">//  this entity hits an entity with the "Solid" component</span></div><div class="line" id="file-components-js-LC38">  <span class="nx">stopOnSolids</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC39">    <span class="k">this</span><span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Solid'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopMovement</span><span class="p">);</span></div><div class="line" id="file-components-js-LC40">&nbsp;</div><div class="line" id="file-components-js-LC41">    <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC42">  <span class="p">},</span></div><div class="line" id="file-components-js-LC43">&nbsp;</div><div class="line" id="file-components-js-LC44">  <span class="c1">// Stops the movement</span></div><div class="line" id="file-components-js-LC45">  <span class="nx">stopMovement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC46">    <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class="line" id="file-components-js-LC47">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC48">      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class="line" id="file-components-js-LC49">      <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class="line" id="file-components-js-LC50">    <span class="p">}</span></div><div class="line" id="file-components-js-LC51">  <span class="p">}</span></div><div class="line" id="file-components-js-LC52"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/b587b0ccb27a93b5b1ce/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/b587b0ccb27a93b5b1ce#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<h3 id="adding-villages-to-be-visited-intro-to-events">Adding villages to be visited (intro to events)</h3>

<p>Our game now consists of a player character square that can move around between trees and bushes. Let’s add some interactivity with tangible results by given the player something to do while they move around. We’ll add “villages” that the player can visit as they move around the screen.</p>

<p>Adding villages also takes just three additions to our code. First, we define a new component named <em>Village</em> and give it a unique color so that they stand out on the game board. Second, we register a callback function that will handle the “visiting” of a village each time the player encounters one. Finally, we add some code to the game startup sequence to spawn some initial villages in random locations.</p>

<p>Here are the additions to our code needed:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/6ae6c08bce483af7ab0c.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4453133" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3">&nbsp;</div><div class="line" id="file-components-js-LC4"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC5"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC6">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC7">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Color, Collision'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC8">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div><div class="line" id="file-components-js-LC9">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(20, 75, 40)'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC10">      <span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">()</span></div><div class="line" id="file-components-js-LC11">      <span class="c1">// Whenever the PC touches a village, respond to the event</span></div><div class="line" id="file-components-js-LC12">      <span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visitVillage</span><span class="p">);</span></div><div class="line" id="file-components-js-LC13">  <span class="p">},</span></div><div class="line" id="file-components-js-LC14">&nbsp;</div><div class="line" id="file-components-js-LC15">  <span class="c1">// Registers a stop-movement function to be called when</span></div><div class="line" id="file-components-js-LC16">  <span class="c1">//  this entity hits an entity with the "Solid" component</span></div><div class="line" id="file-components-js-LC17">  <span class="nx">stopOnSolids</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC18">    <span class="c1">// ...</span></div><div class="line" id="file-components-js-LC19">  <span class="p">},</span></div><div class="line" id="file-components-js-LC20">&nbsp;</div><div class="line" id="file-components-js-LC21">  <span class="c1">// Stops the movement</span></div><div class="line" id="file-components-js-LC22">  <span class="nx">stopMovement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC23">    <span class="c1">// ...</span></div><div class="line" id="file-components-js-LC24">  <span class="p">},</span></div><div class="line" id="file-components-js-LC25">&nbsp;</div><div class="line" id="file-components-js-LC26">  <span class="c1">// Respond to this player visiting a village</span></div><div class="line" id="file-components-js-LC27">  <span class="nx">visitVillage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC28">    <span class="nx">villlage</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">obj</span><span class="p">;</span></div><div class="line" id="file-components-js-LC29">    <span class="nx">villlage</span><span class="p">.</span><span class="nx">collect</span><span class="p">();</span></div><div class="line" id="file-components-js-LC30">  <span class="p">}</span></div><div class="line" id="file-components-js-LC31"><span class="p">});</span></div><div class="line" id="file-components-js-LC32">&nbsp;</div><div class="line" id="file-components-js-LC33"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC34"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC35">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC36">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC37">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(170, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC38">  <span class="p">},</span></div><div class="line" id="file-components-js-LC39">&nbsp;</div><div class="line" id="file-components-js-LC40">  <span class="nx">collect</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC41">    <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC42">  <span class="p">}</span></div><div class="line" id="file-components-js-LC43"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/6ae6c08bce483af7ab0c/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/6ae6c08bce483af7ab0c#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// ...</span></div><div class="line" id="file-game-js-LC3">&nbsp;</div><div class="line" id="file-game-js-LC4">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC5">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC6">    <span class="c1">// ...</span></div><div class="line" id="file-game-js-LC7">&nbsp;</div><div class="line" id="file-game-js-LC8">    <span class="c1">// Generate up to five villages on the map in random locations</span></div><div class="line" id="file-game-js-LC9">    <span class="kd">var</span> <span class="nx">max_villages</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></div><div class="line" id="file-game-js-LC10">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC11">      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC12">        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC13">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-game-js-LC14">&nbsp;</div><div class="line" id="file-game-js-LC15">          <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">max_villages</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC16">            <span class="k">return</span><span class="p">;</span></div><div class="line" id="file-game-js-LC17">          <span class="p">}</span></div><div class="line" id="file-game-js-LC18">        <span class="p">}</span></div><div class="line" id="file-game-js-LC19">      <span class="p">}</span></div><div class="line" id="file-game-js-LC20">    <span class="p">}</span></div><div class="line" id="file-game-js-LC21">  <span class="p">}</span></div><div class="line" id="file-game-js-LC22"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/6ae6c08bce483af7ab0c/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/6ae6c08bce483af7ab0c#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>Here’s what our game looks like now:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_4a.png" alt="Screenshot"></p>

<h3 id="creating-a-victory-screen-and-restarting-the-game">Creating a victory screen and restarting the game</h3>

<p>Having an interactive toy is fun in and of itself, but the experience will be more satisfying if we add a goal for the player to accomplish and a victory screen to greet them at the end when they succeed at their goal. To this end, we’ll track the number of villages the player has visited and show a victory screen saying “Victory!” when they visit the last one. We’ll also allow the player to restart the game from the victory screen so they can play it again.</p>

<p>In order to do this we need to clean up our code, organize it a bit better, and add some robustness to a few of our algorithms. This may be the biggest set of changes we’ve made thus far, but it will pay dividends later on as we add more features to our game.</p>

<p>It’s time we used another of Crafty’s useful built-in concepts: scenes. Scenes are a way of differentiating distinct parts of your game from one another. For our game, we’ll start with two scenes: the “Game” scene which runs the game we’ve been playing all along, and the “Victory” screen which tells the player they have won and allows them to start a new game.</p>

<p>Since scenes are such an important part of our code organization, we’ll make a new file to define these scenes, <em>src/scenes.js</em>.</p>

<p>For our “Loading” screen we’ll just display a simple message in text using a new entity with the <em>2D</em>, <em>DOM</em>, and <em>Text</em> components. These three built-in components make it easy to draw text for your game using standard DOM + CSS browser technology. The only other thing the Victory screen does is wait for the player to press a key and then restarts the game when they do by switching back to the Game scene.</p>

<p>Since we’re already taking some time to improve our code, this is a good time to fix a major problem in our game. Sometimes villages, trees, bushes, and the player are placed on tiles that are already occupied. In addition to being confusing (because the player can only see the last entity placed there) this also makes victory impossible when a village is on top of a bush (because the player character can’t move through them, they get stuck). To work around this issue, we’ll keep track of which tiles are occupied in a 2D array called <em>occupied</em>. Each time we add a new entity to the forest we’ll mark it’s coordinates as occupied in the array. That way when we’re considering putting a new entity down in the forest we can first ensure there isn’t another entity in that spot on our grid already.</p>

<p>Here is all our new code:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/b6f2a278e6cabd998fc5.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4455048" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC6">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Color'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC7">      <span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="s1">'rgb(170, 125, 40)'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC8">  <span class="p">},</span></div><div class="line" id="file-components-js-LC9">&nbsp;</div><div class="line" id="file-components-js-LC10">  <span class="nx">collect</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC11">    <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC12">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></div><div class="line" id="file-components-js-LC13">  <span class="p">}</span></div><div class="line" id="file-components-js-LC14"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// ...</span></div><div class="line" id="file-game-js-LC3">&nbsp;</div><div class="line" id="file-game-js-LC4">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC5">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC6">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC7">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC8">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(249, 223, 125)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC9">&nbsp;</div><div class="line" id="file-game-js-LC10">    <span class="c1">// Simply start the "Game" scene to get things going</span></div><div class="line" id="file-game-js-LC11">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC12">  <span class="p">}</span></div><div class="line" id="file-game-js-LC13"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-index-html-L1" rel="file-index-html-L1">1</span>
            <span class="line-number" id="file-index-html-L2" rel="file-index-html-L2">2</span>
            <span class="line-number" id="file-index-html-L3" rel="file-index-html-L3">3</span>
            <span class="line-number" id="file-index-html-L4" rel="file-index-html-L4">4</span>
            <span class="line-number" id="file-index-html-L5" rel="file-index-html-L5">5</span>
            <span class="line-number" id="file-index-html-L6" rel="file-index-html-L6">6</span>
            <span class="line-number" id="file-index-html-L7" rel="file-index-html-L7">7</span>
            <span class="line-number" id="file-index-html-L8" rel="file-index-html-L8">8</span>
            <span class="line-number" id="file-index-html-L9" rel="file-index-html-L9">9</span>
            <span class="line-number" id="file-index-html-L10" rel="file-index-html-L10">10</span>
            <span class="line-number" id="file-index-html-L11" rel="file-index-html-L11">11</span>
            <span class="line-number" id="file-index-html-L12" rel="file-index-html-L12">12</span>
            <span class="line-number" id="file-index-html-L13" rel="file-index-html-L13">13</span>
            <span class="line-number" id="file-index-html-L14" rel="file-index-html-L14">14</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-index-html-LC1"><span class="cp">&lt;!DOCTYPE html&gt;</span></div><div class="line" id="file-index-html-LC2"><span class="nt">&lt;html&gt;</span></div><div class="line" id="file-index-html-LC3"><span class="nt">&lt;head&gt;</span></div><div class="line" id="file-index-html-LC4">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"lib/crafty.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC5">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/game.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC6">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/components.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC7">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/scenes.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC8">  <span class="nt">&lt;script&gt;</span></div><div class="line" id="file-index-html-LC9">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span></div><div class="line" id="file-index-html-LC10">  <span class="nt">&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC11"><span class="nt">&lt;/head&gt;</span></div><div class="line" id="file-index-html-LC12"><span class="nt">&lt;body&gt;</span></div><div class="line" id="file-index-html-LC13"><span class="nt">&lt;/body&gt;</span></div><div class="line" id="file-index-html-LC14"><span class="nt">&lt;/html&gt;</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5/raw/index.html" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5#file-index-html">index.html</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
            <span class="line-number" id="file-scenes-js-L35" rel="file-scenes-js-L35">35</span>
            <span class="line-number" id="file-scenes-js-L36" rel="file-scenes-js-L36">36</span>
            <span class="line-number" id="file-scenes-js-L37" rel="file-scenes-js-L37">37</span>
            <span class="line-number" id="file-scenes-js-L38" rel="file-scenes-js-L38">38</span>
            <span class="line-number" id="file-scenes-js-L39" rel="file-scenes-js-L39">39</span>
            <span class="line-number" id="file-scenes-js-L40" rel="file-scenes-js-L40">40</span>
            <span class="line-number" id="file-scenes-js-L41" rel="file-scenes-js-L41">41</span>
            <span class="line-number" id="file-scenes-js-L42" rel="file-scenes-js-L42">42</span>
            <span class="line-number" id="file-scenes-js-L43" rel="file-scenes-js-L43">43</span>
            <span class="line-number" id="file-scenes-js-L44" rel="file-scenes-js-L44">44</span>
            <span class="line-number" id="file-scenes-js-L45" rel="file-scenes-js-L45">45</span>
            <span class="line-number" id="file-scenes-js-L46" rel="file-scenes-js-L46">46</span>
            <span class="line-number" id="file-scenes-js-L47" rel="file-scenes-js-L47">47</span>
            <span class="line-number" id="file-scenes-js-L48" rel="file-scenes-js-L48">48</span>
            <span class="line-number" id="file-scenes-js-L49" rel="file-scenes-js-L49">49</span>
            <span class="line-number" id="file-scenes-js-L50" rel="file-scenes-js-L50">50</span>
            <span class="line-number" id="file-scenes-js-L51" rel="file-scenes-js-L51">51</span>
            <span class="line-number" id="file-scenes-js-L52" rel="file-scenes-js-L52">52</span>
            <span class="line-number" id="file-scenes-js-L53" rel="file-scenes-js-L53">53</span>
            <span class="line-number" id="file-scenes-js-L54" rel="file-scenes-js-L54">54</span>
            <span class="line-number" id="file-scenes-js-L55" rel="file-scenes-js-L55">55</span>
            <span class="line-number" id="file-scenes-js-L56" rel="file-scenes-js-L56">56</span>
            <span class="line-number" id="file-scenes-js-L57" rel="file-scenes-js-L57">57</span>
            <span class="line-number" id="file-scenes-js-L58" rel="file-scenes-js-L58">58</span>
            <span class="line-number" id="file-scenes-js-L59" rel="file-scenes-js-L59">59</span>
            <span class="line-number" id="file-scenes-js-L60" rel="file-scenes-js-L60">60</span>
            <span class="line-number" id="file-scenes-js-L61" rel="file-scenes-js-L61">61</span>
            <span class="line-number" id="file-scenes-js-L62" rel="file-scenes-js-L62">62</span>
            <span class="line-number" id="file-scenes-js-L63" rel="file-scenes-js-L63">63</span>
            <span class="line-number" id="file-scenes-js-L64" rel="file-scenes-js-L64">64</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC2">&nbsp;</div><div class="line" id="file-scenes-js-LC3">  <span class="c1">// A 2D array to keep track of all occupied tiles</span></div><div class="line" id="file-scenes-js-LC4">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC5">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC6">    <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC7">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC8">      <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC9">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC10">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC11">&nbsp;</div><div class="line" id="file-scenes-js-LC12">  <span class="c1">// Player character, placed at 5, 5 on our grid</span></div><div class="line" id="file-scenes-js-LC13">  <span class="k">this</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC14">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">x</span><span class="p">][</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC15">&nbsp;</div><div class="line" id="file-scenes-js-LC16">  <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-scenes-js-LC17">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC18">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC19">      <span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC20">&nbsp;</div><div class="line" id="file-scenes-js-LC21">      <span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC22">        <span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-scenes-js-LC23">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC24">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC25">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC26">        <span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-scenes-js-LC27">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC28">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC29">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC30">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC31">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC32">&nbsp;</div><div class="line" id="file-scenes-js-LC33">  <span class="c1">// Generate up to five villages on the map in random locations</span></div><div class="line" id="file-scenes-js-LC34">  <span class="kd">var</span> <span class="nx">max_villages</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC35">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC36">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC37">      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC38">        <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">max_villages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC39">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC40">        <span class="p">}</span></div><div class="line" id="file-scenes-js-LC41">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC42">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC43">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC44">&nbsp;</div><div class="line" id="file-scenes-js-LC45">  <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC46">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC47">      <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC48">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC49">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC50"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC51">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC52"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC53">&nbsp;</div><div class="line" id="file-scenes-js-LC54"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC55">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC56">    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC57">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'Victory!'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC58">&nbsp;</div><div class="line" id="file-scenes-js-LC59">  <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC60">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC61">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC62"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC63">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC64"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/b6f2a278e6cabd998fc5#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>The player can now run around the forest visiting all the villages until they get a victory screen. On the victory screen, they can press any key to restart the game.</p>

<h3 id="adding-rich-graphics-via-sprites-plus-a-loading-screen">Adding rich graphics via sprites (plus a loading screen)</h3>

<p>Unless you tend to prefer an extreme minimalist aesthetic you’ll probably agree that our game is quite bland to look at. Let’s jazz it up with some higher-fidelity graphics. We’ll use bitmap images to provide this rich content for each kind of entity that the player can see on the game screen. However, for performance, maintenance, and scalability reasons we don’t want to have to load a bunch of individual bitmap images from the web server, so we’ll use a common game development technique called “sprite mapping.”</p>

<p>A “sprite” is a 2D image representing a single visual element such as a tree or bush. A sprite map is a bitmapped image that contains multiple sprites. Lucky for us, Crafty makes it very easy to map sprites from a spite map to components and entities.</p>

<p>To start, you load the sprite map image via <em>Crafty.load</em>. Then you call <em>Crafty.sprite</em> and pass in the width (in pixels) of each sprite in the sprite map, the path to the asset (as you used when you loaded the asset), and object defining what each sprite will be called (more on that later), then the horizontal and then vertical padding between each sprite in the sprite map.</p>

<p>Here’s how the object that defines what each sprite will be called works. Each property on the object is named after a sprite in the sprite map that you will later apply to compoments and entities as needed. The value of each property is an two-element array specifying the x and y coordinates, respectively, of the top-left corner of that sprite within the logical grid of the image. Each property name becomes a component that you can assign to components and entities to have them be drawn with that sprite.</p>

<p>There is one more complication we need to deal with, however, before we continue. Since the bitmap sprite image must be loaded before we can display our game, we must now put in a loading screen so that the player knows what’s happening while the image is loading.</p>

<p>We’ll make few other small adjustments as well: for better contrast within our new color pallete we’ll turn the background of the web page black and the background of our game screen to a dark green.</p>

<p>These steps require a lot of small changes and a few big ones as well, so for the sake of clarity, here is all of our code in full:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/7642a765f8b37ae6404d.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4462171" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
            <span class="line-number" id="file-components-js-L44" rel="file-components-js-L44">44</span>
            <span class="line-number" id="file-components-js-L45" rel="file-components-js-L45">45</span>
            <span class="line-number" id="file-components-js-L46" rel="file-components-js-L46">46</span>
            <span class="line-number" id="file-components-js-L47" rel="file-components-js-L47">47</span>
            <span class="line-number" id="file-components-js-L48" rel="file-components-js-L48">48</span>
            <span class="line-number" id="file-components-js-L49" rel="file-components-js-L49">49</span>
            <span class="line-number" id="file-components-js-L50" rel="file-components-js-L50">50</span>
            <span class="line-number" id="file-components-js-L51" rel="file-components-js-L51">51</span>
            <span class="line-number" id="file-components-js-L52" rel="file-components-js-L52">52</span>
            <span class="line-number" id="file-components-js-L53" rel="file-components-js-L53">53</span>
            <span class="line-number" id="file-components-js-L54" rel="file-components-js-L54">54</span>
            <span class="line-number" id="file-components-js-L55" rel="file-components-js-L55">55</span>
            <span class="line-number" id="file-components-js-L56" rel="file-components-js-L56">56</span>
            <span class="line-number" id="file-components-js-L57" rel="file-components-js-L57">57</span>
            <span class="line-number" id="file-components-js-L58" rel="file-components-js-L58">58</span>
            <span class="line-number" id="file-components-js-L59" rel="file-components-js-L59">59</span>
            <span class="line-number" id="file-components-js-L60" rel="file-components-js-L60">60</span>
            <span class="line-number" id="file-components-js-L61" rel="file-components-js-L61">61</span>
            <span class="line-number" id="file-components-js-L62" rel="file-components-js-L62">62</span>
            <span class="line-number" id="file-components-js-L63" rel="file-components-js-L63">63</span>
            <span class="line-number" id="file-components-js-L64" rel="file-components-js-L64">64</span>
            <span class="line-number" id="file-components-js-L65" rel="file-components-js-L65">65</span>
            <span class="line-number" id="file-components-js-L66" rel="file-components-js-L66">66</span>
            <span class="line-number" id="file-components-js-L67" rel="file-components-js-L67">67</span>
            <span class="line-number" id="file-components-js-L68" rel="file-components-js-L68">68</span>
            <span class="line-number" id="file-components-js-L69" rel="file-components-js-L69">69</span>
            <span class="line-number" id="file-components-js-L70" rel="file-components-js-L70">70</span>
            <span class="line-number" id="file-components-js-L71" rel="file-components-js-L71">71</span>
            <span class="line-number" id="file-components-js-L72" rel="file-components-js-L72">72</span>
            <span class="line-number" id="file-components-js-L73" rel="file-components-js-L73">73</span>
            <span class="line-number" id="file-components-js-L74" rel="file-components-js-L74">74</span>
            <span class="line-number" id="file-components-js-L75" rel="file-components-js-L75">75</span>
            <span class="line-number" id="file-components-js-L76" rel="file-components-js-L76">76</span>
            <span class="line-number" id="file-components-js-L77" rel="file-components-js-L77">77</span>
            <span class="line-number" id="file-components-js-L78" rel="file-components-js-L78">78</span>
            <span class="line-number" id="file-components-js-L79" rel="file-components-js-L79">79</span>
            <span class="line-number" id="file-components-js-L80" rel="file-components-js-L80">80</span>
            <span class="line-number" id="file-components-js-L81" rel="file-components-js-L81">81</span>
            <span class="line-number" id="file-components-js-L82" rel="file-components-js-L82">82</span>
            <span class="line-number" id="file-components-js-L83" rel="file-components-js-L83">83</span>
            <span class="line-number" id="file-components-js-L84" rel="file-components-js-L84">84</span>
            <span class="line-number" id="file-components-js-L85" rel="file-components-js-L85">85</span>
            <span class="line-number" id="file-components-js-L86" rel="file-components-js-L86">86</span>
            <span class="line-number" id="file-components-js-L87" rel="file-components-js-L87">87</span>
            <span class="line-number" id="file-components-js-L88" rel="file-components-js-L88">88</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// The Grid component allows an element to be located</span></div><div class="line" id="file-components-js-LC2"><span class="c1">//  on a grid of tiles</span></div><div class="line" id="file-components-js-LC3"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Grid'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC4">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">    <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-components-js-LC6">      <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-components-js-LC7">      <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-components-js-LC8">    <span class="p">})</span></div><div class="line" id="file-components-js-LC9">  <span class="p">},</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11">  <span class="c1">// Locate this entity at the given position on the grid</span></div><div class="line" id="file-components-js-LC12">  <span class="nx">at</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">      <span class="k">return</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">}</span></div><div class="line" id="file-components-js-LC15">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC16">      <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">});</span></div><div class="line" id="file-components-js-LC17">      <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC18">    <span class="p">}</span></div><div class="line" id="file-components-js-LC19">  <span class="p">}</span></div><div class="line" id="file-components-js-LC20"><span class="p">});</span></div><div class="line" id="file-components-js-LC21">&nbsp;</div><div class="line" id="file-components-js-LC22"><span class="c1">// An "Actor" is an entity that is drawn in 2D on canvas</span></div><div class="line" id="file-components-js-LC23"><span class="c1">//  via our logical coordinate grid</span></div><div class="line" id="file-components-js-LC24"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Actor'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC25">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC26">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC27">  <span class="p">},</span></div><div class="line" id="file-components-js-LC28"><span class="p">});</span></div><div class="line" id="file-components-js-LC29">&nbsp;</div><div class="line" id="file-components-js-LC30"><span class="c1">// A Tree is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC31"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC32">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC33">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_tree'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC34">  <span class="p">},</span></div><div class="line" id="file-components-js-LC35"><span class="p">});</span></div><div class="line" id="file-components-js-LC36">&nbsp;</div><div class="line" id="file-components-js-LC37"><span class="c1">// A Bush is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC38"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC39">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC40">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_bush'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC41">  <span class="p">},</span></div><div class="line" id="file-components-js-LC42"><span class="p">});</span></div><div class="line" id="file-components-js-LC43">&nbsp;</div><div class="line" id="file-components-js-LC44"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC45"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC46">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC47">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Collision, spr_player'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC48">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div><div class="line" id="file-components-js-LC49">      <span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">()</span></div><div class="line" id="file-components-js-LC50">      <span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visitVillage</span><span class="p">);</span></div><div class="line" id="file-components-js-LC51">  <span class="p">},</span></div><div class="line" id="file-components-js-LC52">&nbsp;</div><div class="line" id="file-components-js-LC53">  <span class="c1">// Registers a stop-movement function to be called when</span></div><div class="line" id="file-components-js-LC54">  <span class="c1">//  this entity hits an entity with the "Solid" component</span></div><div class="line" id="file-components-js-LC55">  <span class="nx">stopOnSolids</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC56">    <span class="k">this</span><span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Solid'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopMovement</span><span class="p">);</span></div><div class="line" id="file-components-js-LC57">&nbsp;</div><div class="line" id="file-components-js-LC58">    <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC59">  <span class="p">},</span></div><div class="line" id="file-components-js-LC60">&nbsp;</div><div class="line" id="file-components-js-LC61">  <span class="c1">// Stops the movement</span></div><div class="line" id="file-components-js-LC62">  <span class="nx">stopMovement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC63">    <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class="line" id="file-components-js-LC64">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC65">      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class="line" id="file-components-js-LC66">      <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class="line" id="file-components-js-LC67">    <span class="p">}</span></div><div class="line" id="file-components-js-LC68">  <span class="p">},</span></div><div class="line" id="file-components-js-LC69">&nbsp;</div><div class="line" id="file-components-js-LC70">  <span class="c1">// Respond to this player visiting a village</span></div><div class="line" id="file-components-js-LC71">  <span class="nx">visitVillage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC72">    <span class="nx">villlage</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">obj</span><span class="p">;</span></div><div class="line" id="file-components-js-LC73">    <span class="nx">villlage</span><span class="p">.</span><span class="nx">visit</span><span class="p">();</span></div><div class="line" id="file-components-js-LC74">  <span class="p">}</span></div><div class="line" id="file-components-js-LC75"><span class="p">});</span></div><div class="line" id="file-components-js-LC76">&nbsp;</div><div class="line" id="file-components-js-LC77"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC78"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC79">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC80">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, spr_village'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC81">  <span class="p">},</span></div><div class="line" id="file-components-js-LC82">&nbsp;</div><div class="line" id="file-components-js-LC83">  <span class="c1">// Process a visitation with this village</span></div><div class="line" id="file-components-js-LC84">  <span class="nx">visit</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC85">    <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC86">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></div><div class="line" id="file-components-js-LC87">  <span class="p">}</span></div><div class="line" id="file-components-js-LC88"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
            <span class="line-number" id="file-game-js-L23" rel="file-game-js-L23">23</span>
            <span class="line-number" id="file-game-js-L24" rel="file-game-js-L24">24</span>
            <span class="line-number" id="file-game-js-L25" rel="file-game-js-L25">25</span>
            <span class="line-number" id="file-game-js-L26" rel="file-game-js-L26">26</span>
            <span class="line-number" id="file-game-js-L27" rel="file-game-js-L27">27</span>
            <span class="line-number" id="file-game-js-L28" rel="file-game-js-L28">28</span>
            <span class="line-number" id="file-game-js-L29" rel="file-game-js-L29">29</span>
            <span class="line-number" id="file-game-js-L30" rel="file-game-js-L30">30</span>
            <span class="line-number" id="file-game-js-L31" rel="file-game-js-L31">31</span>
            <span class="line-number" id="file-game-js-L32" rel="file-game-js-L32">32</span>
            <span class="line-number" id="file-game-js-L33" rel="file-game-js-L33">33</span>
            <span class="line-number" id="file-game-js-L34" rel="file-game-js-L34">34</span>
            <span class="line-number" id="file-game-js-L35" rel="file-game-js-L35">35</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// This defines our grid's size and the size of each of its tiles</span></div><div class="line" id="file-game-js-LC3">  <span class="nx">map_grid</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">    <span class="nx">width</span><span class="o">:</span>  <span class="mi">24</span><span class="p">,</span></div><div class="line" id="file-game-js-LC5">    <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC6">    <span class="nx">tile</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC7">      <span class="nx">width</span><span class="o">:</span>  <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC8">      <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span></div><div class="line" id="file-game-js-LC9">    <span class="p">}</span></div><div class="line" id="file-game-js-LC10">  <span class="p">},</span></div><div class="line" id="file-game-js-LC11">&nbsp;</div><div class="line" id="file-game-js-LC12">  <span class="c1">// The total width of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC13">  <span class="c1">//  this is just the width of a tile times the width of the grid</span></div><div class="line" id="file-game-js-LC14">  <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC15">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class="line" id="file-game-js-LC16">  <span class="p">},</span></div><div class="line" id="file-game-js-LC17">&nbsp;</div><div class="line" id="file-game-js-LC18">  <span class="c1">// The total height of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC19">  <span class="c1">//  this is just the height of a tile times the height of the grid</span></div><div class="line" id="file-game-js-LC20">  <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC21">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class="line" id="file-game-js-LC22">  <span class="p">},</span></div><div class="line" id="file-game-js-LC23">&nbsp;</div><div class="line" id="file-game-js-LC24">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC25">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC26">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC27">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC28">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(87, 109, 20)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC29">&nbsp;</div><div class="line" id="file-game-js-LC30">    <span class="c1">// Simply start the "Loading" scene to get things going</span></div><div class="line" id="file-game-js-LC31">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC32">  <span class="p">}</span></div><div class="line" id="file-game-js-LC33"><span class="p">}</span></div><div class="line" id="file-game-js-LC34">&nbsp;</div><div class="line" id="file-game-js-LC35"><span class="nx">$text_css</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'font-size'</span><span class="o">:</span> <span class="s1">'24px'</span><span class="p">,</span> <span class="s1">'font-family'</span><span class="o">:</span> <span class="s1">'Arial'</span><span class="p">,</span> <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'white'</span><span class="p">,</span> <span class="s1">'text-align'</span><span class="o">:</span> <span class="s1">'center'</span> <span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-index-html-L1" rel="file-index-html-L1">1</span>
            <span class="line-number" id="file-index-html-L2" rel="file-index-html-L2">2</span>
            <span class="line-number" id="file-index-html-L3" rel="file-index-html-L3">3</span>
            <span class="line-number" id="file-index-html-L4" rel="file-index-html-L4">4</span>
            <span class="line-number" id="file-index-html-L5" rel="file-index-html-L5">5</span>
            <span class="line-number" id="file-index-html-L6" rel="file-index-html-L6">6</span>
            <span class="line-number" id="file-index-html-L7" rel="file-index-html-L7">7</span>
            <span class="line-number" id="file-index-html-L8" rel="file-index-html-L8">8</span>
            <span class="line-number" id="file-index-html-L9" rel="file-index-html-L9">9</span>
            <span class="line-number" id="file-index-html-L10" rel="file-index-html-L10">10</span>
            <span class="line-number" id="file-index-html-L11" rel="file-index-html-L11">11</span>
            <span class="line-number" id="file-index-html-L12" rel="file-index-html-L12">12</span>
            <span class="line-number" id="file-index-html-L13" rel="file-index-html-L13">13</span>
            <span class="line-number" id="file-index-html-L14" rel="file-index-html-L14">14</span>
            <span class="line-number" id="file-index-html-L15" rel="file-index-html-L15">15</span>
            <span class="line-number" id="file-index-html-L16" rel="file-index-html-L16">16</span>
            <span class="line-number" id="file-index-html-L17" rel="file-index-html-L17">17</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-index-html-LC1"><span class="cp">&lt;!DOCTYPE html&gt;</span></div><div class="line" id="file-index-html-LC2"><span class="nt">&lt;html&gt;</span></div><div class="line" id="file-index-html-LC3"><span class="nt">&lt;head&gt;</span></div><div class="line" id="file-index-html-LC4">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"lib/crafty.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC5">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/game.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC6">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/components.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC7">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/scenes.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC8">  <span class="nt">&lt;script&gt;</span></div><div class="line" id="file-index-html-LC9">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span></div><div class="line" id="file-index-html-LC10">  <span class="nt">&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC11">  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span></div><div class="line" id="file-index-html-LC12">    <span class="nt">body</span> <span class="p">{</span> <span class="k">background</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span> <span class="p">}</span></div><div class="line" id="file-index-html-LC13">  <span class="nt">&lt;/style&gt;</span></div><div class="line" id="file-index-html-LC14"><span class="nt">&lt;/head&gt;</span></div><div class="line" id="file-index-html-LC15"><span class="nt">&lt;body&gt;</span></div><div class="line" id="file-index-html-LC16"><span class="nt">&lt;/body&gt;</span></div><div class="line" id="file-index-html-LC17"><span class="nt">&lt;/html&gt;</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d/raw/index.html" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d#file-index-html">index.html</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
            <span class="line-number" id="file-scenes-js-L35" rel="file-scenes-js-L35">35</span>
            <span class="line-number" id="file-scenes-js-L36" rel="file-scenes-js-L36">36</span>
            <span class="line-number" id="file-scenes-js-L37" rel="file-scenes-js-L37">37</span>
            <span class="line-number" id="file-scenes-js-L38" rel="file-scenes-js-L38">38</span>
            <span class="line-number" id="file-scenes-js-L39" rel="file-scenes-js-L39">39</span>
            <span class="line-number" id="file-scenes-js-L40" rel="file-scenes-js-L40">40</span>
            <span class="line-number" id="file-scenes-js-L41" rel="file-scenes-js-L41">41</span>
            <span class="line-number" id="file-scenes-js-L42" rel="file-scenes-js-L42">42</span>
            <span class="line-number" id="file-scenes-js-L43" rel="file-scenes-js-L43">43</span>
            <span class="line-number" id="file-scenes-js-L44" rel="file-scenes-js-L44">44</span>
            <span class="line-number" id="file-scenes-js-L45" rel="file-scenes-js-L45">45</span>
            <span class="line-number" id="file-scenes-js-L46" rel="file-scenes-js-L46">46</span>
            <span class="line-number" id="file-scenes-js-L47" rel="file-scenes-js-L47">47</span>
            <span class="line-number" id="file-scenes-js-L48" rel="file-scenes-js-L48">48</span>
            <span class="line-number" id="file-scenes-js-L49" rel="file-scenes-js-L49">49</span>
            <span class="line-number" id="file-scenes-js-L50" rel="file-scenes-js-L50">50</span>
            <span class="line-number" id="file-scenes-js-L51" rel="file-scenes-js-L51">51</span>
            <span class="line-number" id="file-scenes-js-L52" rel="file-scenes-js-L52">52</span>
            <span class="line-number" id="file-scenes-js-L53" rel="file-scenes-js-L53">53</span>
            <span class="line-number" id="file-scenes-js-L54" rel="file-scenes-js-L54">54</span>
            <span class="line-number" id="file-scenes-js-L55" rel="file-scenes-js-L55">55</span>
            <span class="line-number" id="file-scenes-js-L56" rel="file-scenes-js-L56">56</span>
            <span class="line-number" id="file-scenes-js-L57" rel="file-scenes-js-L57">57</span>
            <span class="line-number" id="file-scenes-js-L58" rel="file-scenes-js-L58">58</span>
            <span class="line-number" id="file-scenes-js-L59" rel="file-scenes-js-L59">59</span>
            <span class="line-number" id="file-scenes-js-L60" rel="file-scenes-js-L60">60</span>
            <span class="line-number" id="file-scenes-js-L61" rel="file-scenes-js-L61">61</span>
            <span class="line-number" id="file-scenes-js-L62" rel="file-scenes-js-L62">62</span>
            <span class="line-number" id="file-scenes-js-L63" rel="file-scenes-js-L63">63</span>
            <span class="line-number" id="file-scenes-js-L64" rel="file-scenes-js-L64">64</span>
            <span class="line-number" id="file-scenes-js-L65" rel="file-scenes-js-L65">65</span>
            <span class="line-number" id="file-scenes-js-L66" rel="file-scenes-js-L66">66</span>
            <span class="line-number" id="file-scenes-js-L67" rel="file-scenes-js-L67">67</span>
            <span class="line-number" id="file-scenes-js-L68" rel="file-scenes-js-L68">68</span>
            <span class="line-number" id="file-scenes-js-L69" rel="file-scenes-js-L69">69</span>
            <span class="line-number" id="file-scenes-js-L70" rel="file-scenes-js-L70">70</span>
            <span class="line-number" id="file-scenes-js-L71" rel="file-scenes-js-L71">71</span>
            <span class="line-number" id="file-scenes-js-L72" rel="file-scenes-js-L72">72</span>
            <span class="line-number" id="file-scenes-js-L73" rel="file-scenes-js-L73">73</span>
            <span class="line-number" id="file-scenes-js-L74" rel="file-scenes-js-L74">74</span>
            <span class="line-number" id="file-scenes-js-L75" rel="file-scenes-js-L75">75</span>
            <span class="line-number" id="file-scenes-js-L76" rel="file-scenes-js-L76">76</span>
            <span class="line-number" id="file-scenes-js-L77" rel="file-scenes-js-L77">77</span>
            <span class="line-number" id="file-scenes-js-L78" rel="file-scenes-js-L78">78</span>
            <span class="line-number" id="file-scenes-js-L79" rel="file-scenes-js-L79">79</span>
            <span class="line-number" id="file-scenes-js-L80" rel="file-scenes-js-L80">80</span>
            <span class="line-number" id="file-scenes-js-L81" rel="file-scenes-js-L81">81</span>
            <span class="line-number" id="file-scenes-js-L82" rel="file-scenes-js-L82">82</span>
            <span class="line-number" id="file-scenes-js-L83" rel="file-scenes-js-L83">83</span>
            <span class="line-number" id="file-scenes-js-L84" rel="file-scenes-js-L84">84</span>
            <span class="line-number" id="file-scenes-js-L85" rel="file-scenes-js-L85">85</span>
            <span class="line-number" id="file-scenes-js-L86" rel="file-scenes-js-L86">86</span>
            <span class="line-number" id="file-scenes-js-L87" rel="file-scenes-js-L87">87</span>
            <span class="line-number" id="file-scenes-js-L88" rel="file-scenes-js-L88">88</span>
            <span class="line-number" id="file-scenes-js-L89" rel="file-scenes-js-L89">89</span>
            <span class="line-number" id="file-scenes-js-L90" rel="file-scenes-js-L90">90</span>
            <span class="line-number" id="file-scenes-js-L91" rel="file-scenes-js-L91">91</span>
            <span class="line-number" id="file-scenes-js-L92" rel="file-scenes-js-L92">92</span>
            <span class="line-number" id="file-scenes-js-L93" rel="file-scenes-js-L93">93</span>
            <span class="line-number" id="file-scenes-js-L94" rel="file-scenes-js-L94">94</span>
            <span class="line-number" id="file-scenes-js-L95" rel="file-scenes-js-L95">95</span>
            <span class="line-number" id="file-scenes-js-L96" rel="file-scenes-js-L96">96</span>
            <span class="line-number" id="file-scenes-js-L97" rel="file-scenes-js-L97">97</span>
            <span class="line-number" id="file-scenes-js-L98" rel="file-scenes-js-L98">98</span>
            <span class="line-number" id="file-scenes-js-L99" rel="file-scenes-js-L99">99</span>
            <span class="line-number" id="file-scenes-js-L100" rel="file-scenes-js-L100">100</span>
            <span class="line-number" id="file-scenes-js-L101" rel="file-scenes-js-L101">101</span>
            <span class="line-number" id="file-scenes-js-L102" rel="file-scenes-js-L102">102</span>
            <span class="line-number" id="file-scenes-js-L103" rel="file-scenes-js-L103">103</span>
            <span class="line-number" id="file-scenes-js-L104" rel="file-scenes-js-L104">104</span>
            <span class="line-number" id="file-scenes-js-L105" rel="file-scenes-js-L105">105</span>
            <span class="line-number" id="file-scenes-js-L106" rel="file-scenes-js-L106">106</span>
            <span class="line-number" id="file-scenes-js-L107" rel="file-scenes-js-L107">107</span>
            <span class="line-number" id="file-scenes-js-L108" rel="file-scenes-js-L108">108</span>
            <span class="line-number" id="file-scenes-js-L109" rel="file-scenes-js-L109">109</span>
            <span class="line-number" id="file-scenes-js-L110" rel="file-scenes-js-L110">110</span>
            <span class="line-number" id="file-scenes-js-L111" rel="file-scenes-js-L111">111</span>
            <span class="line-number" id="file-scenes-js-L112" rel="file-scenes-js-L112">112</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="c1">// Game scene</span></div><div class="line" id="file-scenes-js-LC2"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC3"><span class="c1">// Runs the core gameplay loop</span></div><div class="line" id="file-scenes-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC5">  <span class="c1">// A 2D array to keep track of all occupied tiles</span></div><div class="line" id="file-scenes-js-LC6">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC7">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC8">    <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC9">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC10">      <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC11">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC12">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC13">&nbsp;</div><div class="line" id="file-scenes-js-LC14">  <span class="c1">// Player character, placed at 5, 5 on our grid</span></div><div class="line" id="file-scenes-js-LC15">  <span class="k">this</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC16">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">x</span><span class="p">][</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC17">&nbsp;</div><div class="line" id="file-scenes-js-LC18">  <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-scenes-js-LC19">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC20">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC21">      <span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC22">&nbsp;</div><div class="line" id="file-scenes-js-LC23">      <span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC24">        <span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-scenes-js-LC25">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC26">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC27">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC28">        <span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-scenes-js-LC29">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC30">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC31">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC32">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC33">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC34">&nbsp;</div><div class="line" id="file-scenes-js-LC35">  <span class="c1">// Generate up to five villages on the map in random locations</span></div><div class="line" id="file-scenes-js-LC36">  <span class="kd">var</span> <span class="nx">max_villages</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC37">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC38">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC39">      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC40">        <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">max_villages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC41">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC42">        <span class="p">}</span></div><div class="line" id="file-scenes-js-LC43">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC44">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC45">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC46">&nbsp;</div><div class="line" id="file-scenes-js-LC47">  <span class="c1">// Show the victory screen once all villages are visisted</span></div><div class="line" id="file-scenes-js-LC48">  <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC49">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC50">      <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC51">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC52">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC53"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC54">  <span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC55">  <span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC56">  <span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC57">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC58"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC59">&nbsp;</div><div class="line" id="file-scenes-js-LC60">&nbsp;</div><div class="line" id="file-scenes-js-LC61"><span class="c1">// Victory scene</span></div><div class="line" id="file-scenes-js-LC62"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC63"><span class="c1">// Tells the player when they've won and lets them start a new game</span></div><div class="line" id="file-scenes-js-LC64"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC65">  <span class="c1">// Display some text in celebration of the victory</span></div><div class="line" id="file-scenes-js-LC66">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC67">    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC68">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'Victory!'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC69">&nbsp;</div><div class="line" id="file-scenes-js-LC70">  <span class="c1">// Watch for the player to press a key, then restart the game</span></div><div class="line" id="file-scenes-js-LC71">  <span class="c1">//  when a key is pressed</span></div><div class="line" id="file-scenes-js-LC72">  <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC73">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC74">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC75"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC76">  <span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC77">  <span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC78">  <span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC79">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC80"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC81">&nbsp;</div><div class="line" id="file-scenes-js-LC82"><span class="c1">// Loading scene</span></div><div class="line" id="file-scenes-js-LC83"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC84"><span class="c1">// Handles the loading of binary assets such as images and audio files</span></div><div class="line" id="file-scenes-js-LC85"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC86">  <span class="c1">// Draw some text for the player to see in case the file</span></div><div class="line" id="file-scenes-js-LC87">  <span class="c1">//  takes a noticeable amount of time to load</span></div><div class="line" id="file-scenes-js-LC88">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC89">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'Loading...'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC90">    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC91">    <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">$text_css</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC92">&nbsp;</div><div class="line" id="file-scenes-js-LC93">  <span class="c1">// Load our sprite map image</span></div><div class="line" id="file-scenes-js-LC94">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span><span class="s1">'assets/16x16_forest_1.gif'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC95">    <span class="c1">// Once the image is loaded...</span></div><div class="line" id="file-scenes-js-LC96">&nbsp;</div><div class="line" id="file-scenes-js-LC97">    <span class="c1">// Define the individual sprites in the image</span></div><div class="line" id="file-scenes-js-LC98">    <span class="c1">// Each one (spr_tree, etc.) becomes a component</span></div><div class="line" id="file-scenes-js-LC99">    <span class="c1">// These components' names are prefixed with "spr_"</span></div><div class="line" id="file-scenes-js-LC100">    <span class="c1">//  to remind us that they simply cause the entity</span></div><div class="line" id="file-scenes-js-LC101">    <span class="c1">//  to be drawn with a certain sprite</span></div><div class="line" id="file-scenes-js-LC102">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/16x16_forest_1.gif'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC103">      <span class="nx">spr_tree</span><span class="o">:</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC104">      <span class="nx">spr_bush</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC105">      <span class="nx">spr_village</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC106">      <span class="nx">spr_player</span><span class="o">:</span>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC107">    <span class="p">});</span></div><div class="line" id="file-scenes-js-LC108">&nbsp;</div><div class="line" id="file-scenes-js-LC109">    <span class="c1">// Now that our sprites are ready to draw, start the game</span></div><div class="line" id="file-scenes-js-LC110">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC111">  <span class="p">})</span></div><div class="line" id="file-scenes-js-LC112"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/7642a765f8b37ae6404d#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>Here’s what our game looks like now:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_5a.png" alt="Screenshot"></p>

<p><em>Attribution: The sprite map used here was adapted from an overworld sprite map by Sharm at <a href="http://opengameart.org/">OpenGameArt</a>. The hunter in the sprite map is from a sprite map by Antifarea at OpenGameArt.</em></p>

<h3 id="adding-animation-and-state-based-sprite-changes">Adding animation and state-based sprite changes</h3>

<p>Our game is coming together very nicely, but moving around feels very strange because PC seems to be paralyzed and hovering around the screen while always staring the same direction. To make it seem like she’s walking, let’s animate her steps as she moves around. Even better, we’ll make her look as though she’s facing the direction in which she’s currently moving.</p>

<p>To do this we change the PC entity from using a sprite from our sprite map (from the last step) to using its own dedicated sprite map image which will have a special kind of formatting for animation purposes.</p>

<p>First, we need to load our new image that defines the PC animations. Then we define the PC’s sprite to be the first sprite in the third row of the animation sprite map. Next, we add the <em>SpriteAnimation</em> component to the PC entity and define four animations – one for each of our four directions in which we can move. Finally, we’ll add code to watch for a change of direction and switch animations accordingly. Because we used Crafty’s <em>Fourway</em> component for our movement behavior for PC, we can simply listen for a “NewDirection” event to detect a change of direction and respond to that.</p>

<p>Here is the code that accomplishes this:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/3d848cc275e5a4ed6c4e.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4462559" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC6">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Collision, spr_player, SpriteAnimation'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC7">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div><div class="line" id="file-components-js-LC8">      <span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">()</span></div><div class="line" id="file-components-js-LC9">      <span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visitVillage</span><span class="p">)</span></div><div class="line" id="file-components-js-LC10">      <span class="c1">// These next lines define our four animations</span></div><div class="line" id="file-components-js-LC11">      <span class="c1">//  each call to .animate specifies:</span></div><div class="line" id="file-components-js-LC12">      <span class="c1">//  - the name of the animation</span></div><div class="line" id="file-components-js-LC13">      <span class="c1">//  - the x and y coordinates within the sprite</span></div><div class="line" id="file-components-js-LC14">      <span class="c1">//     map at which the animation set begins</span></div><div class="line" id="file-components-js-LC15">      <span class="c1">//  - the number of animation frames *in addition to* the first one</span></div><div class="line" id="file-components-js-LC16">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC17">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC18">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC19">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></div><div class="line" id="file-components-js-LC20">&nbsp;</div><div class="line" id="file-components-js-LC21">    <span class="c1">// Watch for a change of direction and switch animations accordingly</span></div><div class="line" id="file-components-js-LC22">    <span class="kd">var</span> <span class="nx">animation_speed</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span></div><div class="line" id="file-components-js-LC23">    <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'NewDirection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC24">      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC25">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC26">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC27">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC28">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC29">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC30">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC31">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC32">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC33">        <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class="line" id="file-components-js-LC34">      <span class="p">}</span></div><div class="line" id="file-components-js-LC35">    <span class="p">});</span></div><div class="line" id="file-components-js-LC36">  <span class="p">},</span></div><div class="line" id="file-components-js-LC37">&nbsp;</div><div class="line" id="file-components-js-LC38">  <span class="c1">// ...</span></div><div class="line" id="file-components-js-LC39"><span class="p">});</span></div><div class="line" id="file-components-js-LC40">&nbsp;</div><div class="line" id="file-components-js-LC41"><span class="c1">// ...</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/3d848cc275e5a4ed6c4e/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/3d848cc275e5a4ed6c4e#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC2">&nbsp;</div><div class="line" id="file-scenes-js-LC3"><span class="c1">// Loading scene</span></div><div class="line" id="file-scenes-js-LC4"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC5"><span class="c1">// Handles the loading of binary assets such as images and audio files</span></div><div class="line" id="file-scenes-js-LC6"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC7">  <span class="c1">// Draw some text for the player to see in case the file</span></div><div class="line" id="file-scenes-js-LC8">  <span class="c1">//  takes a noticeable amount of time to load</span></div><div class="line" id="file-scenes-js-LC9">  <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC10">&nbsp;</div><div class="line" id="file-scenes-js-LC11">  <span class="c1">// Load our sprite map image</span></div><div class="line" id="file-scenes-js-LC12">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span><span class="s1">'assets/16x16_forest_1.gif'</span><span class="p">,</span> <span class="s1">'assets/hunter.png'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC13">    <span class="c1">// Once the images are loaded...</span></div><div class="line" id="file-scenes-js-LC14">&nbsp;</div><div class="line" id="file-scenes-js-LC15">    <span class="c1">// Define the individual sprites in the image</span></div><div class="line" id="file-scenes-js-LC16">    <span class="c1">// Each one (spr_tree, etc.) becomes a component</span></div><div class="line" id="file-scenes-js-LC17">    <span class="c1">// These components' names are prefixed with "spr_"</span></div><div class="line" id="file-scenes-js-LC18">    <span class="c1">//  to remind us that they simply cause the entity</span></div><div class="line" id="file-scenes-js-LC19">    <span class="c1">//  to be drawn with a certain sprite</span></div><div class="line" id="file-scenes-js-LC20">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/16x16_forest_1.gif'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC21">      <span class="nx">spr_tree</span><span class="o">:</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC22">      <span class="nx">spr_bush</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC23">      <span class="nx">spr_village</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC24">    <span class="p">});</span></div><div class="line" id="file-scenes-js-LC25">&nbsp;</div><div class="line" id="file-scenes-js-LC26">    <span class="c1">// Define the PC's sprite to be the first sprite in the third row of the</span></div><div class="line" id="file-scenes-js-LC27">    <span class="c1">//  animation sprite map</span></div><div class="line" id="file-scenes-js-LC28">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/hunter.png'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC29">      <span class="nx">spr_player</span><span class="o">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC30">    <span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC31">&nbsp;</div><div class="line" id="file-scenes-js-LC32">    <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC33">  <span class="p">})</span></div><div class="line" id="file-scenes-js-LC34"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/3d848cc275e5a4ed6c4e/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/3d848cc275e5a4ed6c4e#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>PC now appears to walk around as we would expect her to, at least so long as you’re only moving her up, down, left, or right at a given time.</p>

<p>Here’s what our game looks like now:</p>

<p><img src="./An introduction to the Crafty game engine - Build New Games_files/screenshot_6a.png" alt="Here&#39;s what our game looks like now"></p>

<p><em>Attribution: The hunter sprite map used here is from Antifarea at OpenGameArt.</em></p>

<p>Here is a JSFiddle demonstrating our game. Note that because of JSFiddle’s limitations, the contents of <em>game.js</em>, <em>scenes.js</em>, and <em>components.js</em> are combined into the JS part of the fiddle.</p>

<iframe style="width: 100%; height: 320px" src="./An introduction to the Crafty game engine - Build New Games_files/saved_resource.html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h3 id="adding-sound">Adding sound</h3>

<p>We can make our game more engaging by adding some sound effects to punctuate the player’s progress in visiting the villages. We’ll add sound effect that plays every time we visit a village. Crafty makes it very easy to implement such simple sounds and fire them when needed.</p>

<p>First, we add the sound effect file, <em>door_knock</em>3x.mp3<em>, to the list of assets we load in the Loading scene. Then, we define the sound effect future use by calling _Crafty.audio.add</em> and naming that sound “knock”. Finally, we call Crafty.audio.play and specify the “knock” sound every time a village is visited.</p>

<p>Here is the code that accomplishes this:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/ccf535652ff6e5d7282f.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4468436" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-components-js-LC2">&nbsp;</div><div class="line" id="file-components-js-LC3"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">  <span class="c1">// ...</span></div><div class="line" id="file-components-js-LC6">&nbsp;</div><div class="line" id="file-components-js-LC7">  <span class="c1">// Process a visitation with this village</span></div><div class="line" id="file-components-js-LC8">  <span class="nx">visit</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC9">    <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC10">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'knock'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC11">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></div><div class="line" id="file-components-js-LC12">  <span class="p">}</span></div><div class="line" id="file-components-js-LC13"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/ccf535652ff6e5d7282f/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/ccf535652ff6e5d7282f#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
            <span class="line-number" id="file-scenes-js-L35" rel="file-scenes-js-L35">35</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC2">&nbsp;</div><div class="line" id="file-scenes-js-LC3"><span class="c1">// Loading scene</span></div><div class="line" id="file-scenes-js-LC4"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC5"><span class="c1">// Handles the loading of binary assets such as images and audio files</span></div><div class="line" id="file-scenes-js-LC6"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC7">  <span class="c1">// Draw some text for the player to see in case the file</span></div><div class="line" id="file-scenes-js-LC8">  <span class="c1">//  takes a noticeable amount of time to load</span></div><div class="line" id="file-scenes-js-LC9">  <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC10">&nbsp;</div><div class="line" id="file-scenes-js-LC11">  <span class="c1">// Load our image and audio assets</span></div><div class="line" id="file-scenes-js-LC12">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span><span class="s1">'assets/16x16_forest_1.gif'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC13">               <span class="s1">'assets/hunter.png'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC14">               <span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC15">               <span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC16">               <span class="s1">'assets/door_knock_3x.aac'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC17">    <span class="c1">// Once the assets are loaded...</span></div><div class="line" id="file-scenes-js-LC18">&nbsp;</div><div class="line" id="file-scenes-js-LC19">    <span class="c1">// Define the individual sprites in the image</span></div><div class="line" id="file-scenes-js-LC20">    <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC21">&nbsp;</div><div class="line" id="file-scenes-js-LC22">    <span class="c1">// Define the PC's sprite to be the first sprite in the third row of the</span></div><div class="line" id="file-scenes-js-LC23">    <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC24">&nbsp;</div><div class="line" id="file-scenes-js-LC25">    <span class="c1">// Define our sounds for later use</span></div><div class="line" id="file-scenes-js-LC26">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span></div><div class="line" id="file-scenes-js-LC27">      <span class="nx">knock</span><span class="o">:</span> <span class="p">[</span><span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC28">              <span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC29">              <span class="s1">'assets/door_knock_3x.aac'</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC30">    <span class="p">});</span></div><div class="line" id="file-scenes-js-LC31">&nbsp;</div><div class="line" id="file-scenes-js-LC32">    <span class="c1">// Now that our sprites are ready to draw, start the game</span></div><div class="line" id="file-scenes-js-LC33">    <span class="c1">// ...</span></div><div class="line" id="file-scenes-js-LC34">  <span class="p">})</span></div><div class="line" id="file-scenes-js-LC35"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/ccf535652ff6e5d7282f/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/ccf535652ff6e5d7282f#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<h3 id="a-coat-of-polish-to-finish-it-off">A coat of polish to finish it off</h3>

<p>Our game is now functionally complete. But it feels very unfinished, so let’s add some polish to give it a more solid feeling. Most notably, we’ll add two more sounds – one for when the game starts and one for when you win – and one more entity for our map – the rock, which is exactly like a bush but with a different look to it.</p>

<p>Other miscellaneous changes:</p>

<ul>
  <li>Ensure five villages are spawned for each game</li>
  <li>PC speed (via Fourway component) reduced to 2 and animation speed commensurately reduced to 4</li>
  <li>Game window centered on screen</li>
  <li>Victory and Loading screen text wording, color, size, and positioning improved</li>
  <li>Wait a few seconds after showing victory screen before allowing a game restart</li>
</ul>

<p>Here’s our final code:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/20d50b28723191b60566.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist4471940" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
            <span class="line-number" id="file-components-js-L44" rel="file-components-js-L44">44</span>
            <span class="line-number" id="file-components-js-L45" rel="file-components-js-L45">45</span>
            <span class="line-number" id="file-components-js-L46" rel="file-components-js-L46">46</span>
            <span class="line-number" id="file-components-js-L47" rel="file-components-js-L47">47</span>
            <span class="line-number" id="file-components-js-L48" rel="file-components-js-L48">48</span>
            <span class="line-number" id="file-components-js-L49" rel="file-components-js-L49">49</span>
            <span class="line-number" id="file-components-js-L50" rel="file-components-js-L50">50</span>
            <span class="line-number" id="file-components-js-L51" rel="file-components-js-L51">51</span>
            <span class="line-number" id="file-components-js-L52" rel="file-components-js-L52">52</span>
            <span class="line-number" id="file-components-js-L53" rel="file-components-js-L53">53</span>
            <span class="line-number" id="file-components-js-L54" rel="file-components-js-L54">54</span>
            <span class="line-number" id="file-components-js-L55" rel="file-components-js-L55">55</span>
            <span class="line-number" id="file-components-js-L56" rel="file-components-js-L56">56</span>
            <span class="line-number" id="file-components-js-L57" rel="file-components-js-L57">57</span>
            <span class="line-number" id="file-components-js-L58" rel="file-components-js-L58">58</span>
            <span class="line-number" id="file-components-js-L59" rel="file-components-js-L59">59</span>
            <span class="line-number" id="file-components-js-L60" rel="file-components-js-L60">60</span>
            <span class="line-number" id="file-components-js-L61" rel="file-components-js-L61">61</span>
            <span class="line-number" id="file-components-js-L62" rel="file-components-js-L62">62</span>
            <span class="line-number" id="file-components-js-L63" rel="file-components-js-L63">63</span>
            <span class="line-number" id="file-components-js-L64" rel="file-components-js-L64">64</span>
            <span class="line-number" id="file-components-js-L65" rel="file-components-js-L65">65</span>
            <span class="line-number" id="file-components-js-L66" rel="file-components-js-L66">66</span>
            <span class="line-number" id="file-components-js-L67" rel="file-components-js-L67">67</span>
            <span class="line-number" id="file-components-js-L68" rel="file-components-js-L68">68</span>
            <span class="line-number" id="file-components-js-L69" rel="file-components-js-L69">69</span>
            <span class="line-number" id="file-components-js-L70" rel="file-components-js-L70">70</span>
            <span class="line-number" id="file-components-js-L71" rel="file-components-js-L71">71</span>
            <span class="line-number" id="file-components-js-L72" rel="file-components-js-L72">72</span>
            <span class="line-number" id="file-components-js-L73" rel="file-components-js-L73">73</span>
            <span class="line-number" id="file-components-js-L74" rel="file-components-js-L74">74</span>
            <span class="line-number" id="file-components-js-L75" rel="file-components-js-L75">75</span>
            <span class="line-number" id="file-components-js-L76" rel="file-components-js-L76">76</span>
            <span class="line-number" id="file-components-js-L77" rel="file-components-js-L77">77</span>
            <span class="line-number" id="file-components-js-L78" rel="file-components-js-L78">78</span>
            <span class="line-number" id="file-components-js-L79" rel="file-components-js-L79">79</span>
            <span class="line-number" id="file-components-js-L80" rel="file-components-js-L80">80</span>
            <span class="line-number" id="file-components-js-L81" rel="file-components-js-L81">81</span>
            <span class="line-number" id="file-components-js-L82" rel="file-components-js-L82">82</span>
            <span class="line-number" id="file-components-js-L83" rel="file-components-js-L83">83</span>
            <span class="line-number" id="file-components-js-L84" rel="file-components-js-L84">84</span>
            <span class="line-number" id="file-components-js-L85" rel="file-components-js-L85">85</span>
            <span class="line-number" id="file-components-js-L86" rel="file-components-js-L86">86</span>
            <span class="line-number" id="file-components-js-L87" rel="file-components-js-L87">87</span>
            <span class="line-number" id="file-components-js-L88" rel="file-components-js-L88">88</span>
            <span class="line-number" id="file-components-js-L89" rel="file-components-js-L89">89</span>
            <span class="line-number" id="file-components-js-L90" rel="file-components-js-L90">90</span>
            <span class="line-number" id="file-components-js-L91" rel="file-components-js-L91">91</span>
            <span class="line-number" id="file-components-js-L92" rel="file-components-js-L92">92</span>
            <span class="line-number" id="file-components-js-L93" rel="file-components-js-L93">93</span>
            <span class="line-number" id="file-components-js-L94" rel="file-components-js-L94">94</span>
            <span class="line-number" id="file-components-js-L95" rel="file-components-js-L95">95</span>
            <span class="line-number" id="file-components-js-L96" rel="file-components-js-L96">96</span>
            <span class="line-number" id="file-components-js-L97" rel="file-components-js-L97">97</span>
            <span class="line-number" id="file-components-js-L98" rel="file-components-js-L98">98</span>
            <span class="line-number" id="file-components-js-L99" rel="file-components-js-L99">99</span>
            <span class="line-number" id="file-components-js-L100" rel="file-components-js-L100">100</span>
            <span class="line-number" id="file-components-js-L101" rel="file-components-js-L101">101</span>
            <span class="line-number" id="file-components-js-L102" rel="file-components-js-L102">102</span>
            <span class="line-number" id="file-components-js-L103" rel="file-components-js-L103">103</span>
            <span class="line-number" id="file-components-js-L104" rel="file-components-js-L104">104</span>
            <span class="line-number" id="file-components-js-L105" rel="file-components-js-L105">105</span>
            <span class="line-number" id="file-components-js-L106" rel="file-components-js-L106">106</span>
            <span class="line-number" id="file-components-js-L107" rel="file-components-js-L107">107</span>
            <span class="line-number" id="file-components-js-L108" rel="file-components-js-L108">108</span>
            <span class="line-number" id="file-components-js-L109" rel="file-components-js-L109">109</span>
            <span class="line-number" id="file-components-js-L110" rel="file-components-js-L110">110</span>
            <span class="line-number" id="file-components-js-L111" rel="file-components-js-L111">111</span>
            <span class="line-number" id="file-components-js-L112" rel="file-components-js-L112">112</span>
            <span class="line-number" id="file-components-js-L113" rel="file-components-js-L113">113</span>
            <span class="line-number" id="file-components-js-L114" rel="file-components-js-L114">114</span>
            <span class="line-number" id="file-components-js-L115" rel="file-components-js-L115">115</span>
            <span class="line-number" id="file-components-js-L116" rel="file-components-js-L116">116</span>
            <span class="line-number" id="file-components-js-L117" rel="file-components-js-L117">117</span>
            <span class="line-number" id="file-components-js-L118" rel="file-components-js-L118">118</span>
            <span class="line-number" id="file-components-js-L119" rel="file-components-js-L119">119</span>
            <span class="line-number" id="file-components-js-L120" rel="file-components-js-L120">120</span>
            <span class="line-number" id="file-components-js-L121" rel="file-components-js-L121">121</span>
            <span class="line-number" id="file-components-js-L122" rel="file-components-js-L122">122</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// The Grid component allows an element to be located</span></div><div class="line" id="file-components-js-LC2"><span class="c1">//  on a grid of tiles</span></div><div class="line" id="file-components-js-LC3"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Grid'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC4">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">    <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-components-js-LC6">      <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-components-js-LC7">      <span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-components-js-LC8">    <span class="p">})</span></div><div class="line" id="file-components-js-LC9">  <span class="p">},</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11">  <span class="c1">// Locate this entity at the given position on the grid</span></div><div class="line" id="file-components-js-LC12">  <span class="nx">at</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">      <span class="k">return</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">}</span></div><div class="line" id="file-components-js-LC15">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC16">      <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">});</span></div><div class="line" id="file-components-js-LC17">      <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC18">    <span class="p">}</span></div><div class="line" id="file-components-js-LC19">  <span class="p">}</span></div><div class="line" id="file-components-js-LC20"><span class="p">});</span></div><div class="line" id="file-components-js-LC21">&nbsp;</div><div class="line" id="file-components-js-LC22"><span class="c1">// An "Actor" is an entity that is drawn in 2D on canvas</span></div><div class="line" id="file-components-js-LC23"><span class="c1">//  via our logical coordinate grid</span></div><div class="line" id="file-components-js-LC24"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Actor'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC25">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC26">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC27">  <span class="p">},</span></div><div class="line" id="file-components-js-LC28"><span class="p">});</span></div><div class="line" id="file-components-js-LC29">&nbsp;</div><div class="line" id="file-components-js-LC30"><span class="c1">// A Tree is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC31"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC32">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC33">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_tree'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC34">  <span class="p">},</span></div><div class="line" id="file-components-js-LC35"><span class="p">});</span></div><div class="line" id="file-components-js-LC36">&nbsp;</div><div class="line" id="file-components-js-LC37"><span class="c1">// A Bush is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC38"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC39">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC40">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_bush'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC41">  <span class="p">},</span></div><div class="line" id="file-components-js-LC42"><span class="p">});</span></div><div class="line" id="file-components-js-LC43">&nbsp;</div><div class="line" id="file-components-js-LC44"><span class="c1">// A Rock is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC45"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Rock'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC46">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC47">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_rock'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC48">  <span class="p">},</span></div><div class="line" id="file-components-js-LC49"><span class="p">});</span></div><div class="line" id="file-components-js-LC50">&nbsp;</div><div class="line" id="file-components-js-LC51"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC52"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC53">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC54">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Collision, spr_player, SpriteAnimation'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC55">      <span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC56">      <span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">()</span></div><div class="line" id="file-components-js-LC57">      <span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visitVillage</span><span class="p">)</span></div><div class="line" id="file-components-js-LC58">      <span class="c1">// These next lines define our four animations</span></div><div class="line" id="file-components-js-LC59">      <span class="c1">//  each call to .animate specifies:</span></div><div class="line" id="file-components-js-LC60">      <span class="c1">//  - the name of the animation</span></div><div class="line" id="file-components-js-LC61">      <span class="c1">//  - the x and y coordinates within the sprite</span></div><div class="line" id="file-components-js-LC62">      <span class="c1">//     map at which the animation set begins</span></div><div class="line" id="file-components-js-LC63">      <span class="c1">//  - the number of animation frames *in addition to* the first one</span></div><div class="line" id="file-components-js-LC64">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC65">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC66">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC67">      <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></div><div class="line" id="file-components-js-LC68">&nbsp;</div><div class="line" id="file-components-js-LC69">    <span class="c1">// Watch for a change of direction and switch animations accordingly</span></div><div class="line" id="file-components-js-LC70">    <span class="kd">var</span> <span class="nx">animation_speed</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span></div><div class="line" id="file-components-js-LC71">    <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'NewDirection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC72">      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC73">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC74">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC75">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC76">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC77">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC78">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC79">        <span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span> <span class="nx">animation_speed</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC80">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC81">        <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class="line" id="file-components-js-LC82">      <span class="p">}</span></div><div class="line" id="file-components-js-LC83">    <span class="p">});</span></div><div class="line" id="file-components-js-LC84">  <span class="p">},</span></div><div class="line" id="file-components-js-LC85">&nbsp;</div><div class="line" id="file-components-js-LC86">  <span class="c1">// Registers a stop-movement function to be called when</span></div><div class="line" id="file-components-js-LC87">  <span class="c1">//  this entity hits an entity with the "Solid" component</span></div><div class="line" id="file-components-js-LC88">  <span class="nx">stopOnSolids</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC89">    <span class="k">this</span><span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Solid'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopMovement</span><span class="p">);</span></div><div class="line" id="file-components-js-LC90">&nbsp;</div><div class="line" id="file-components-js-LC91">    <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC92">  <span class="p">},</span></div><div class="line" id="file-components-js-LC93">&nbsp;</div><div class="line" id="file-components-js-LC94">  <span class="c1">// Stops the movement</span></div><div class="line" id="file-components-js-LC95">  <span class="nx">stopMovement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC96">    <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class="line" id="file-components-js-LC97">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC98">      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class="line" id="file-components-js-LC99">      <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class="line" id="file-components-js-LC100">    <span class="p">}</span></div><div class="line" id="file-components-js-LC101">  <span class="p">},</span></div><div class="line" id="file-components-js-LC102">&nbsp;</div><div class="line" id="file-components-js-LC103">  <span class="c1">// Respond to this player visiting a village</span></div><div class="line" id="file-components-js-LC104">  <span class="nx">visitVillage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC105">    <span class="nx">villlage</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">obj</span><span class="p">;</span></div><div class="line" id="file-components-js-LC106">    <span class="nx">villlage</span><span class="p">.</span><span class="nx">visit</span><span class="p">();</span></div><div class="line" id="file-components-js-LC107">  <span class="p">}</span></div><div class="line" id="file-components-js-LC108"><span class="p">});</span></div><div class="line" id="file-components-js-LC109">&nbsp;</div><div class="line" id="file-components-js-LC110"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC111"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC112">  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC113">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, spr_village'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC114">  <span class="p">},</span></div><div class="line" id="file-components-js-LC115">&nbsp;</div><div class="line" id="file-components-js-LC116">  <span class="c1">// Process a visitation with this village</span></div><div class="line" id="file-components-js-LC117">  <span class="nx">visit</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC118">    <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC119">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'knock'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC120">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></div><div class="line" id="file-components-js-LC121">  <span class="p">}</span></div><div class="line" id="file-components-js-LC122"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
            <span class="line-number" id="file-game-js-L23" rel="file-game-js-L23">23</span>
            <span class="line-number" id="file-game-js-L24" rel="file-game-js-L24">24</span>
            <span class="line-number" id="file-game-js-L25" rel="file-game-js-L25">25</span>
            <span class="line-number" id="file-game-js-L26" rel="file-game-js-L26">26</span>
            <span class="line-number" id="file-game-js-L27" rel="file-game-js-L27">27</span>
            <span class="line-number" id="file-game-js-L28" rel="file-game-js-L28">28</span>
            <span class="line-number" id="file-game-js-L29" rel="file-game-js-L29">29</span>
            <span class="line-number" id="file-game-js-L30" rel="file-game-js-L30">30</span>
            <span class="line-number" id="file-game-js-L31" rel="file-game-js-L31">31</span>
            <span class="line-number" id="file-game-js-L32" rel="file-game-js-L32">32</span>
            <span class="line-number" id="file-game-js-L33" rel="file-game-js-L33">33</span>
            <span class="line-number" id="file-game-js-L34" rel="file-game-js-L34">34</span>
            <span class="line-number" id="file-game-js-L35" rel="file-game-js-L35">35</span>
            <span class="line-number" id="file-game-js-L36" rel="file-game-js-L36">36</span>
            <span class="line-number" id="file-game-js-L37" rel="file-game-js-L37">37</span>
            <span class="line-number" id="file-game-js-L38" rel="file-game-js-L38">38</span>
            <span class="line-number" id="file-game-js-L39" rel="file-game-js-L39">39</span>
            <span class="line-number" id="file-game-js-L40" rel="file-game-js-L40">40</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">  <span class="c1">// This defines our grid's size and the size of each of its tiles</span></div><div class="line" id="file-game-js-LC3">  <span class="nx">map_grid</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">    <span class="nx">width</span><span class="o">:</span>  <span class="mi">24</span><span class="p">,</span></div><div class="line" id="file-game-js-LC5">    <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC6">    <span class="nx">tile</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC7">      <span class="nx">width</span><span class="o">:</span>  <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC8">      <span class="nx">height</span><span class="o">:</span> <span class="mi">16</span></div><div class="line" id="file-game-js-LC9">    <span class="p">}</span></div><div class="line" id="file-game-js-LC10">  <span class="p">},</span></div><div class="line" id="file-game-js-LC11">&nbsp;</div><div class="line" id="file-game-js-LC12">  <span class="c1">// The total width of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC13">  <span class="c1">//  this is just the width of a tile times the width of the grid</span></div><div class="line" id="file-game-js-LC14">  <span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC15">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class="line" id="file-game-js-LC16">  <span class="p">},</span></div><div class="line" id="file-game-js-LC17">&nbsp;</div><div class="line" id="file-game-js-LC18">  <span class="c1">// The total height of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC19">  <span class="c1">//  this is just the height of a tile times the height of the grid</span></div><div class="line" id="file-game-js-LC20">  <span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC21">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class="line" id="file-game-js-LC22">  <span class="p">},</span></div><div class="line" id="file-game-js-LC23">&nbsp;</div><div class="line" id="file-game-js-LC24">  <span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC25">  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC26">    <span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC27">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC28">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(87, 109, 20)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC29">&nbsp;</div><div class="line" id="file-game-js-LC30">    <span class="c1">// Simply start the "Loading" scene to get things going</span></div><div class="line" id="file-game-js-LC31">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC32">  <span class="p">}</span></div><div class="line" id="file-game-js-LC33"><span class="p">}</span></div><div class="line" id="file-game-js-LC34">&nbsp;</div><div class="line" id="file-game-js-LC35"><span class="nx">$text_css</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC36">  <span class="s1">'font-size'</span><span class="o">:</span> <span class="s1">'24px'</span><span class="p">,</span></div><div class="line" id="file-game-js-LC37">  <span class="s1">'font-family'</span><span class="o">:</span> <span class="s1">'Arial'</span><span class="p">,</span></div><div class="line" id="file-game-js-LC38">  <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'white'</span><span class="p">,</span></div><div class="line" id="file-game-js-LC39">  <span class="s1">'text-align'</span><span class="o">:</span> <span class="s1">'center'</span></div><div class="line" id="file-game-js-LC40"><span class="p">}</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-index-html-L1" rel="file-index-html-L1">1</span>
            <span class="line-number" id="file-index-html-L2" rel="file-index-html-L2">2</span>
            <span class="line-number" id="file-index-html-L3" rel="file-index-html-L3">3</span>
            <span class="line-number" id="file-index-html-L4" rel="file-index-html-L4">4</span>
            <span class="line-number" id="file-index-html-L5" rel="file-index-html-L5">5</span>
            <span class="line-number" id="file-index-html-L6" rel="file-index-html-L6">6</span>
            <span class="line-number" id="file-index-html-L7" rel="file-index-html-L7">7</span>
            <span class="line-number" id="file-index-html-L8" rel="file-index-html-L8">8</span>
            <span class="line-number" id="file-index-html-L9" rel="file-index-html-L9">9</span>
            <span class="line-number" id="file-index-html-L10" rel="file-index-html-L10">10</span>
            <span class="line-number" id="file-index-html-L11" rel="file-index-html-L11">11</span>
            <span class="line-number" id="file-index-html-L12" rel="file-index-html-L12">12</span>
            <span class="line-number" id="file-index-html-L13" rel="file-index-html-L13">13</span>
            <span class="line-number" id="file-index-html-L14" rel="file-index-html-L14">14</span>
            <span class="line-number" id="file-index-html-L15" rel="file-index-html-L15">15</span>
            <span class="line-number" id="file-index-html-L16" rel="file-index-html-L16">16</span>
            <span class="line-number" id="file-index-html-L17" rel="file-index-html-L17">17</span>
            <span class="line-number" id="file-index-html-L18" rel="file-index-html-L18">18</span>
            <span class="line-number" id="file-index-html-L19" rel="file-index-html-L19">19</span>
            <span class="line-number" id="file-index-html-L20" rel="file-index-html-L20">20</span>
            <span class="line-number" id="file-index-html-L21" rel="file-index-html-L21">21</span>
            <span class="line-number" id="file-index-html-L22" rel="file-index-html-L22">22</span>
            <span class="line-number" id="file-index-html-L23" rel="file-index-html-L23">23</span>
            <span class="line-number" id="file-index-html-L24" rel="file-index-html-L24">24</span>
            <span class="line-number" id="file-index-html-L25" rel="file-index-html-L25">25</span>
            <span class="line-number" id="file-index-html-L26" rel="file-index-html-L26">26</span>
            <span class="line-number" id="file-index-html-L27" rel="file-index-html-L27">27</span>
            <span class="line-number" id="file-index-html-L28" rel="file-index-html-L28">28</span>
            <span class="line-number" id="file-index-html-L29" rel="file-index-html-L29">29</span>
            <span class="line-number" id="file-index-html-L30" rel="file-index-html-L30">30</span>
            <span class="line-number" id="file-index-html-L31" rel="file-index-html-L31">31</span>
            <span class="line-number" id="file-index-html-L32" rel="file-index-html-L32">32</span>
            <span class="line-number" id="file-index-html-L33" rel="file-index-html-L33">33</span>
            <span class="line-number" id="file-index-html-L34" rel="file-index-html-L34">34</span>
            <span class="line-number" id="file-index-html-L35" rel="file-index-html-L35">35</span>
            <span class="line-number" id="file-index-html-L36" rel="file-index-html-L36">36</span>
            <span class="line-number" id="file-index-html-L37" rel="file-index-html-L37">37</span>
            <span class="line-number" id="file-index-html-L38" rel="file-index-html-L38">38</span>
            <span class="line-number" id="file-index-html-L39" rel="file-index-html-L39">39</span>
            <span class="line-number" id="file-index-html-L40" rel="file-index-html-L40">40</span>
            <span class="line-number" id="file-index-html-L41" rel="file-index-html-L41">41</span>
            <span class="line-number" id="file-index-html-L42" rel="file-index-html-L42">42</span>
            <span class="line-number" id="file-index-html-L43" rel="file-index-html-L43">43</span>
            <span class="line-number" id="file-index-html-L44" rel="file-index-html-L44">44</span>
            <span class="line-number" id="file-index-html-L45" rel="file-index-html-L45">45</span>
            <span class="line-number" id="file-index-html-L46" rel="file-index-html-L46">46</span>
            <span class="line-number" id="file-index-html-L47" rel="file-index-html-L47">47</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-index-html-LC1"><span class="cp">&lt;!DOCTYPE html&gt;</span></div><div class="line" id="file-index-html-LC2"><span class="nt">&lt;html&gt;</span></div><div class="line" id="file-index-html-LC3"><span class="nt">&lt;head&gt;</span></div><div class="line" id="file-index-html-LC4">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"lib/crafty.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC5">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/game.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC6">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/components.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC7">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"src/scenes.js"</span><span class="nt">&gt;&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC8">  <span class="nt">&lt;script&gt;</span></div><div class="line" id="file-index-html-LC9">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span></div><div class="line" id="file-index-html-LC10">  <span class="nt">&lt;/script&gt;</span></div><div class="line" id="file-index-html-LC11">  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span></div><div class="line" id="file-index-html-LC12">    <span class="nt">body</span> <span class="p">{</span></div><div class="line" id="file-index-html-LC13">      <span class="k">background</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span></div><div class="line" id="file-index-html-LC14">      <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span></div><div class="line" id="file-index-html-LC15">      <span class="k">color</span><span class="o">:</span> <span class="m">#DDD</span><span class="p">;</span></div><div class="line" id="file-index-html-LC16">      <span class="k">font-family</span><span class="o">:</span> <span class="n">Arial</span><span class="p">;</span></div><div class="line" id="file-index-html-LC17">    <span class="p">}</span></div><div class="line" id="file-index-html-LC18">&nbsp;</div><div class="line" id="file-index-html-LC19">    <span class="nc">.controls</span> <span class="p">{</span></div><div class="line" id="file-index-html-LC20">      <span class="k">color</span><span class="o">:</span> <span class="m">#BBB</span><span class="p">;</span></div><div class="line" id="file-index-html-LC21">    <span class="p">}</span></div><div class="line" id="file-index-html-LC22">&nbsp;</div><div class="line" id="file-index-html-LC23">    <span class="nf">#cr-stage</span> <span class="p">{</span> <span class="k">margin</span><span class="o">:</span> <span class="m">20px</span> <span class="k">auto</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span></div><div class="line" id="file-index-html-LC24">&nbsp;</div><div class="line" id="file-index-html-LC25">    <span class="nc">.bottom</span> <span class="p">{</span></div><div class="line" id="file-index-html-LC26">      <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span></div><div class="line" id="file-index-html-LC27">      <span class="k">color</span><span class="o">:</span> <span class="m">#888</span><span class="p">;</span></div><div class="line" id="file-index-html-LC28">      <span class="k">margin-top</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span></div><div class="line" id="file-index-html-LC29">    <span class="p">}</span></div><div class="line" id="file-index-html-LC30">&nbsp;</div><div class="line" id="file-index-html-LC31">    <span class="nc">.bottom</span> <span class="nt">a</span> <span class="p">{</span></div><div class="line" id="file-index-html-LC32">      <span class="k">color</span><span class="o">:</span> <span class="m">#AAA</span><span class="p">;</span></div><div class="line" id="file-index-html-LC33">    <span class="p">}</span></div><div class="line" id="file-index-html-LC34">  <span class="nt">&lt;/style&gt;</span></div><div class="line" id="file-index-html-LC35"><span class="nt">&lt;/head&gt;</span></div><div class="line" id="file-index-html-LC36"><span class="nt">&lt;body&gt;</span></div><div class="line" id="file-index-html-LC37">  <span class="nt">&lt;h2&gt;</span>Crafty's Adventure<span class="nt">&lt;/h2&gt;</span></div><div class="line" id="file-index-html-LC38">&nbsp;</div><div class="line" id="file-index-html-LC39">  <span class="nt">&lt;p&gt;</span>Help Crafty visit her friends in each village.<span class="nt">&lt;/p&gt;</span></div><div class="line" id="file-index-html-LC40">&nbsp;</div><div class="line" id="file-index-html-LC41">  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"controls"</span><span class="nt">&gt;</span>Controls: Use W, A, S, and D or arrow keys to move around.<span class="nt">&lt;/p&gt;</span></div><div class="line" id="file-index-html-LC42">&nbsp;</div><div class="line" id="file-index-html-LC43">  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"cr-stage"</span><span class="nt">&gt;&lt;/div&gt;</span></div><div class="line" id="file-index-html-LC44">&nbsp;</div><div class="line" id="file-index-html-LC45">  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"bottom"</span><span class="nt">&gt;</span>Created for the "Introduction to Crafty Game Engine" tutorial on <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://buildnewgames.com"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>Build New Games<span class="nt">&lt;/a&gt;</span>.</div><div class="line" id="file-index-html-LC46"><span class="nt">&lt;/body&gt;</span></div><div class="line" id="file-index-html-LC47"><span class="nt">&lt;/html&gt;</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566/raw/index.html" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566#file-index-html">index.html</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
            <span class="line-number" id="file-scenes-js-L35" rel="file-scenes-js-L35">35</span>
            <span class="line-number" id="file-scenes-js-L36" rel="file-scenes-js-L36">36</span>
            <span class="line-number" id="file-scenes-js-L37" rel="file-scenes-js-L37">37</span>
            <span class="line-number" id="file-scenes-js-L38" rel="file-scenes-js-L38">38</span>
            <span class="line-number" id="file-scenes-js-L39" rel="file-scenes-js-L39">39</span>
            <span class="line-number" id="file-scenes-js-L40" rel="file-scenes-js-L40">40</span>
            <span class="line-number" id="file-scenes-js-L41" rel="file-scenes-js-L41">41</span>
            <span class="line-number" id="file-scenes-js-L42" rel="file-scenes-js-L42">42</span>
            <span class="line-number" id="file-scenes-js-L43" rel="file-scenes-js-L43">43</span>
            <span class="line-number" id="file-scenes-js-L44" rel="file-scenes-js-L44">44</span>
            <span class="line-number" id="file-scenes-js-L45" rel="file-scenes-js-L45">45</span>
            <span class="line-number" id="file-scenes-js-L46" rel="file-scenes-js-L46">46</span>
            <span class="line-number" id="file-scenes-js-L47" rel="file-scenes-js-L47">47</span>
            <span class="line-number" id="file-scenes-js-L48" rel="file-scenes-js-L48">48</span>
            <span class="line-number" id="file-scenes-js-L49" rel="file-scenes-js-L49">49</span>
            <span class="line-number" id="file-scenes-js-L50" rel="file-scenes-js-L50">50</span>
            <span class="line-number" id="file-scenes-js-L51" rel="file-scenes-js-L51">51</span>
            <span class="line-number" id="file-scenes-js-L52" rel="file-scenes-js-L52">52</span>
            <span class="line-number" id="file-scenes-js-L53" rel="file-scenes-js-L53">53</span>
            <span class="line-number" id="file-scenes-js-L54" rel="file-scenes-js-L54">54</span>
            <span class="line-number" id="file-scenes-js-L55" rel="file-scenes-js-L55">55</span>
            <span class="line-number" id="file-scenes-js-L56" rel="file-scenes-js-L56">56</span>
            <span class="line-number" id="file-scenes-js-L57" rel="file-scenes-js-L57">57</span>
            <span class="line-number" id="file-scenes-js-L58" rel="file-scenes-js-L58">58</span>
            <span class="line-number" id="file-scenes-js-L59" rel="file-scenes-js-L59">59</span>
            <span class="line-number" id="file-scenes-js-L60" rel="file-scenes-js-L60">60</span>
            <span class="line-number" id="file-scenes-js-L61" rel="file-scenes-js-L61">61</span>
            <span class="line-number" id="file-scenes-js-L62" rel="file-scenes-js-L62">62</span>
            <span class="line-number" id="file-scenes-js-L63" rel="file-scenes-js-L63">63</span>
            <span class="line-number" id="file-scenes-js-L64" rel="file-scenes-js-L64">64</span>
            <span class="line-number" id="file-scenes-js-L65" rel="file-scenes-js-L65">65</span>
            <span class="line-number" id="file-scenes-js-L66" rel="file-scenes-js-L66">66</span>
            <span class="line-number" id="file-scenes-js-L67" rel="file-scenes-js-L67">67</span>
            <span class="line-number" id="file-scenes-js-L68" rel="file-scenes-js-L68">68</span>
            <span class="line-number" id="file-scenes-js-L69" rel="file-scenes-js-L69">69</span>
            <span class="line-number" id="file-scenes-js-L70" rel="file-scenes-js-L70">70</span>
            <span class="line-number" id="file-scenes-js-L71" rel="file-scenes-js-L71">71</span>
            <span class="line-number" id="file-scenes-js-L72" rel="file-scenes-js-L72">72</span>
            <span class="line-number" id="file-scenes-js-L73" rel="file-scenes-js-L73">73</span>
            <span class="line-number" id="file-scenes-js-L74" rel="file-scenes-js-L74">74</span>
            <span class="line-number" id="file-scenes-js-L75" rel="file-scenes-js-L75">75</span>
            <span class="line-number" id="file-scenes-js-L76" rel="file-scenes-js-L76">76</span>
            <span class="line-number" id="file-scenes-js-L77" rel="file-scenes-js-L77">77</span>
            <span class="line-number" id="file-scenes-js-L78" rel="file-scenes-js-L78">78</span>
            <span class="line-number" id="file-scenes-js-L79" rel="file-scenes-js-L79">79</span>
            <span class="line-number" id="file-scenes-js-L80" rel="file-scenes-js-L80">80</span>
            <span class="line-number" id="file-scenes-js-L81" rel="file-scenes-js-L81">81</span>
            <span class="line-number" id="file-scenes-js-L82" rel="file-scenes-js-L82">82</span>
            <span class="line-number" id="file-scenes-js-L83" rel="file-scenes-js-L83">83</span>
            <span class="line-number" id="file-scenes-js-L84" rel="file-scenes-js-L84">84</span>
            <span class="line-number" id="file-scenes-js-L85" rel="file-scenes-js-L85">85</span>
            <span class="line-number" id="file-scenes-js-L86" rel="file-scenes-js-L86">86</span>
            <span class="line-number" id="file-scenes-js-L87" rel="file-scenes-js-L87">87</span>
            <span class="line-number" id="file-scenes-js-L88" rel="file-scenes-js-L88">88</span>
            <span class="line-number" id="file-scenes-js-L89" rel="file-scenes-js-L89">89</span>
            <span class="line-number" id="file-scenes-js-L90" rel="file-scenes-js-L90">90</span>
            <span class="line-number" id="file-scenes-js-L91" rel="file-scenes-js-L91">91</span>
            <span class="line-number" id="file-scenes-js-L92" rel="file-scenes-js-L92">92</span>
            <span class="line-number" id="file-scenes-js-L93" rel="file-scenes-js-L93">93</span>
            <span class="line-number" id="file-scenes-js-L94" rel="file-scenes-js-L94">94</span>
            <span class="line-number" id="file-scenes-js-L95" rel="file-scenes-js-L95">95</span>
            <span class="line-number" id="file-scenes-js-L96" rel="file-scenes-js-L96">96</span>
            <span class="line-number" id="file-scenes-js-L97" rel="file-scenes-js-L97">97</span>
            <span class="line-number" id="file-scenes-js-L98" rel="file-scenes-js-L98">98</span>
            <span class="line-number" id="file-scenes-js-L99" rel="file-scenes-js-L99">99</span>
            <span class="line-number" id="file-scenes-js-L100" rel="file-scenes-js-L100">100</span>
            <span class="line-number" id="file-scenes-js-L101" rel="file-scenes-js-L101">101</span>
            <span class="line-number" id="file-scenes-js-L102" rel="file-scenes-js-L102">102</span>
            <span class="line-number" id="file-scenes-js-L103" rel="file-scenes-js-L103">103</span>
            <span class="line-number" id="file-scenes-js-L104" rel="file-scenes-js-L104">104</span>
            <span class="line-number" id="file-scenes-js-L105" rel="file-scenes-js-L105">105</span>
            <span class="line-number" id="file-scenes-js-L106" rel="file-scenes-js-L106">106</span>
            <span class="line-number" id="file-scenes-js-L107" rel="file-scenes-js-L107">107</span>
            <span class="line-number" id="file-scenes-js-L108" rel="file-scenes-js-L108">108</span>
            <span class="line-number" id="file-scenes-js-L109" rel="file-scenes-js-L109">109</span>
            <span class="line-number" id="file-scenes-js-L110" rel="file-scenes-js-L110">110</span>
            <span class="line-number" id="file-scenes-js-L111" rel="file-scenes-js-L111">111</span>
            <span class="line-number" id="file-scenes-js-L112" rel="file-scenes-js-L112">112</span>
            <span class="line-number" id="file-scenes-js-L113" rel="file-scenes-js-L113">113</span>
            <span class="line-number" id="file-scenes-js-L114" rel="file-scenes-js-L114">114</span>
            <span class="line-number" id="file-scenes-js-L115" rel="file-scenes-js-L115">115</span>
            <span class="line-number" id="file-scenes-js-L116" rel="file-scenes-js-L116">116</span>
            <span class="line-number" id="file-scenes-js-L117" rel="file-scenes-js-L117">117</span>
            <span class="line-number" id="file-scenes-js-L118" rel="file-scenes-js-L118">118</span>
            <span class="line-number" id="file-scenes-js-L119" rel="file-scenes-js-L119">119</span>
            <span class="line-number" id="file-scenes-js-L120" rel="file-scenes-js-L120">120</span>
            <span class="line-number" id="file-scenes-js-L121" rel="file-scenes-js-L121">121</span>
            <span class="line-number" id="file-scenes-js-L122" rel="file-scenes-js-L122">122</span>
            <span class="line-number" id="file-scenes-js-L123" rel="file-scenes-js-L123">123</span>
            <span class="line-number" id="file-scenes-js-L124" rel="file-scenes-js-L124">124</span>
            <span class="line-number" id="file-scenes-js-L125" rel="file-scenes-js-L125">125</span>
            <span class="line-number" id="file-scenes-js-L126" rel="file-scenes-js-L126">126</span>
            <span class="line-number" id="file-scenes-js-L127" rel="file-scenes-js-L127">127</span>
            <span class="line-number" id="file-scenes-js-L128" rel="file-scenes-js-L128">128</span>
            <span class="line-number" id="file-scenes-js-L129" rel="file-scenes-js-L129">129</span>
            <span class="line-number" id="file-scenes-js-L130" rel="file-scenes-js-L130">130</span>
            <span class="line-number" id="file-scenes-js-L131" rel="file-scenes-js-L131">131</span>
            <span class="line-number" id="file-scenes-js-L132" rel="file-scenes-js-L132">132</span>
            <span class="line-number" id="file-scenes-js-L133" rel="file-scenes-js-L133">133</span>
            <span class="line-number" id="file-scenes-js-L134" rel="file-scenes-js-L134">134</span>
            <span class="line-number" id="file-scenes-js-L135" rel="file-scenes-js-L135">135</span>
            <span class="line-number" id="file-scenes-js-L136" rel="file-scenes-js-L136">136</span>
            <span class="line-number" id="file-scenes-js-L137" rel="file-scenes-js-L137">137</span>
            <span class="line-number" id="file-scenes-js-L138" rel="file-scenes-js-L138">138</span>
            <span class="line-number" id="file-scenes-js-L139" rel="file-scenes-js-L139">139</span>
            <span class="line-number" id="file-scenes-js-L140" rel="file-scenes-js-L140">140</span>
            <span class="line-number" id="file-scenes-js-L141" rel="file-scenes-js-L141">141</span>
            <span class="line-number" id="file-scenes-js-L142" rel="file-scenes-js-L142">142</span>
            <span class="line-number" id="file-scenes-js-L143" rel="file-scenes-js-L143">143</span>
            <span class="line-number" id="file-scenes-js-L144" rel="file-scenes-js-L144">144</span>
            <span class="line-number" id="file-scenes-js-L145" rel="file-scenes-js-L145">145</span>
            <span class="line-number" id="file-scenes-js-L146" rel="file-scenes-js-L146">146</span>
            <span class="line-number" id="file-scenes-js-L147" rel="file-scenes-js-L147">147</span>
            <span class="line-number" id="file-scenes-js-L148" rel="file-scenes-js-L148">148</span>
            <span class="line-number" id="file-scenes-js-L149" rel="file-scenes-js-L149">149</span>
            <span class="line-number" id="file-scenes-js-L150" rel="file-scenes-js-L150">150</span>
            <span class="line-number" id="file-scenes-js-L151" rel="file-scenes-js-L151">151</span>
            <span class="line-number" id="file-scenes-js-L152" rel="file-scenes-js-L152">152</span>
            <span class="line-number" id="file-scenes-js-L153" rel="file-scenes-js-L153">153</span>
            <span class="line-number" id="file-scenes-js-L154" rel="file-scenes-js-L154">154</span>
            <span class="line-number" id="file-scenes-js-L155" rel="file-scenes-js-L155">155</span>
            <span class="line-number" id="file-scenes-js-L156" rel="file-scenes-js-L156">156</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="c1">// Game scene</span></div><div class="line" id="file-scenes-js-LC2"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC3"><span class="c1">// Runs the core gameplay loop</span></div><div class="line" id="file-scenes-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC5">  <span class="c1">// A 2D array to keep track of all occupied tiles</span></div><div class="line" id="file-scenes-js-LC6">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC7">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC8">    <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC9">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC10">      <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC11">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC12">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC13">&nbsp;</div><div class="line" id="file-scenes-js-LC14">  <span class="c1">// Player character, placed at 5, 5 on our grid</span></div><div class="line" id="file-scenes-js-LC15">  <span class="k">this</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC16">  <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">x</span><span class="p">][</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC17">&nbsp;</div><div class="line" id="file-scenes-js-LC18">  <span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-scenes-js-LC19">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC20">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC21">      <span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span></div><div class="line" id="file-scenes-js-LC22">                    <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC23">&nbsp;</div><div class="line" id="file-scenes-js-LC24">      <span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC25">        <span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-scenes-js-LC26">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC27">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC28">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC29">        <span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-scenes-js-LC30">        <span class="kd">var</span> <span class="nx">bush_or_rock</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'Bush'</span> <span class="o">:</span> <span class="s1">'Rock'</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC31">        <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">bush_or_rock</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC32">        <span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC33">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC34">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC35">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC36">&nbsp;</div><div class="line" id="file-scenes-js-LC37">  <span class="c1">// Generate five villages on the map in random locations</span></div><div class="line" id="file-scenes-js-LC38">  <span class="kd">var</span> <span class="nx">max_villages</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC39">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC40">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC41">      <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC42">        <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">max_villages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC43">          <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC44">        <span class="p">}</span></div><div class="line" id="file-scenes-js-LC45">      <span class="p">}</span></div><div class="line" id="file-scenes-js-LC46">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC47">  <span class="p">}</span></div><div class="line" id="file-scenes-js-LC48">&nbsp;</div><div class="line" id="file-scenes-js-LC49">  <span class="c1">// Play a ringing sound to indicate the start of the journey</span></div><div class="line" id="file-scenes-js-LC50">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'ring'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC51">&nbsp;</div><div class="line" id="file-scenes-js-LC52">  <span class="c1">// Show the victory screen once all villages are visisted</span></div><div class="line" id="file-scenes-js-LC53">  <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC54">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC55">      <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC56">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC57">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC58"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC59">  <span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC60">  <span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC61">  <span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC62">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC63"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC64">&nbsp;</div><div class="line" id="file-scenes-js-LC65">&nbsp;</div><div class="line" id="file-scenes-js-LC66"><span class="c1">// Victory scene</span></div><div class="line" id="file-scenes-js-LC67"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC68"><span class="c1">// Tells the player when they've won and lets them start a new game</span></div><div class="line" id="file-scenes-js-LC69"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC70">  <span class="c1">// Display some text in celebration of the victory</span></div><div class="line" id="file-scenes-js-LC71">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC72">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'All villages visited!'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC73">    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC74">    <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">$text_css</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC75">&nbsp;</div><div class="line" id="file-scenes-js-LC76">  <span class="c1">// Give'em a round of applause!</span></div><div class="line" id="file-scenes-js-LC77">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'applause'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC78">&nbsp;</div><div class="line" id="file-scenes-js-LC79">  <span class="c1">// After a short delay, watch for the player to press a key, then restart</span></div><div class="line" id="file-scenes-js-LC80">  <span class="c1">// the game when a key is pressed</span></div><div class="line" id="file-scenes-js-LC81">  <span class="kd">var</span> <span class="nx">delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC82">  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">delay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC83">  <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC84">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC85">      <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC86">    <span class="p">}</span></div><div class="line" id="file-scenes-js-LC87">  <span class="p">});</span></div><div class="line" id="file-scenes-js-LC88"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC89">  <span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC90">  <span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC91">  <span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC92">  <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC93"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC94">&nbsp;</div><div class="line" id="file-scenes-js-LC95"><span class="c1">// Loading scene</span></div><div class="line" id="file-scenes-js-LC96"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC97"><span class="c1">// Handles the loading of binary assets such as images and audio files</span></div><div class="line" id="file-scenes-js-LC98"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC99">  <span class="c1">// Draw some text for the player to see in case the file</span></div><div class="line" id="file-scenes-js-LC100">  <span class="c1">//  takes a noticeable amount of time to load</span></div><div class="line" id="file-scenes-js-LC101">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC102">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'Loading; please wait...'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC103">    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC104">    <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">$text_css</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC105">&nbsp;</div><div class="line" id="file-scenes-js-LC106">  <span class="c1">// Load our sprite map image</span></div><div class="line" id="file-scenes-js-LC107">  <span class="nx">Crafty</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span></div><div class="line" id="file-scenes-js-LC108">    <span class="s1">'assets/16x16_forest_2.gif'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC109">    <span class="s1">'assets/hunter.png'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC110">    <span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC111">    <span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC112">    <span class="s1">'assets/door_knock_3x.aac'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC113">    <span class="s1">'assets/board_room_applause.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC114">    <span class="s1">'assets/board_room_applause.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC115">    <span class="s1">'assets/board_room_applause.aac'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC116">    <span class="s1">'assets/candy_dish_lid.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC117">    <span class="s1">'assets/candy_dish_lid.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC118">    <span class="s1">'assets/candy_dish_lid.aac'</span></div><div class="line" id="file-scenes-js-LC119">    <span class="p">],</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC120">    <span class="c1">// Once the images are loaded...</span></div><div class="line" id="file-scenes-js-LC121">&nbsp;</div><div class="line" id="file-scenes-js-LC122">    <span class="c1">// Define the individual sprites in the image</span></div><div class="line" id="file-scenes-js-LC123">    <span class="c1">// Each one (spr_tree, etc.) becomes a component</span></div><div class="line" id="file-scenes-js-LC124">    <span class="c1">// These components' names are prefixed with "spr_"</span></div><div class="line" id="file-scenes-js-LC125">    <span class="c1">//  to remind us that they simply cause the entity</span></div><div class="line" id="file-scenes-js-LC126">    <span class="c1">//  to be drawn with a certain sprite</span></div><div class="line" id="file-scenes-js-LC127">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/16x16_forest_2.gif'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC128">      <span class="nx">spr_tree</span><span class="o">:</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC129">      <span class="nx">spr_bush</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC130">      <span class="nx">spr_village</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC131">      <span class="nx">spr_rock</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC132">    <span class="p">});</span></div><div class="line" id="file-scenes-js-LC133">&nbsp;</div><div class="line" id="file-scenes-js-LC134">    <span class="c1">// Define the PC's sprite to be the first sprite in the third row of the</span></div><div class="line" id="file-scenes-js-LC135">    <span class="c1">//  animation sprite map</span></div><div class="line" id="file-scenes-js-LC136">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/hunter.png'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC137">      <span class="nx">spr_player</span><span class="o">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC138">    <span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC139">&nbsp;</div><div class="line" id="file-scenes-js-LC140">    <span class="c1">// Define our sounds for later use</span></div><div class="line" id="file-scenes-js-LC141">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span></div><div class="line" id="file-scenes-js-LC142">      <span class="nx">knock</span><span class="o">:</span>     <span class="p">[</span><span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC143">                  <span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC144">                  <span class="s1">'assets/door_knock_3x.aac'</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC145">      <span class="nx">applause</span><span class="o">:</span>  <span class="p">[</span><span class="s1">'assets/board_room_applause.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC146">                  <span class="s1">'assets/board_room_applause.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC147">                  <span class="s1">'assets/board_room_applause.aac'</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC148">      <span class="nx">ring</span><span class="o">:</span>      <span class="p">[</span><span class="s1">'assets/candy_dish_lid.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC149">                  <span class="s1">'assets/candy_dish_lid.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC150">                  <span class="s1">'assets/candy_dish_lid.aac'</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC151">    <span class="p">});</span></div><div class="line" id="file-scenes-js-LC152">&nbsp;</div><div class="line" id="file-scenes-js-LC153">    <span class="c1">// Now that our sprites are ready to draw, start the game</span></div><div class="line" id="file-scenes-js-LC154">    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC155">  <span class="p">})</span></div><div class="line" id="file-scenes-js-LC156"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/20d50b28723191b60566#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


<p>You can play the final game <a href="http://buildnewgames.com/assets/article//introduction-to-crafty/tut_bng/index.html">here</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I hope you’ve found this introduction and tutorial helpful and that you find Crafty to be as useful a tool as I have for prototyping simple HTML5 games. Crafty’s community continues to grow and Crafty users share useful new components online on the official <a href="http://craftycomponents.com/">Crafty Components site</a>. If you make a game of your own with Crafty and would like to share it and/or its code with the community, post it on the <a href="https://groups.google.com/forum/#!forum/craftyjs">official Crafty forum</a>.</p>

<h2 id="update-january-20th-2014-upgrading-to-crafty-061">UPDATE (January 20th, 2014): Upgrading to Crafty 0.6.1</h2>

<p>Throughout this tutorial we used Crafty 0.5.3 to build our game. In the year since I first wrote it, Crafty has since made significant improvements as it has evolved. Many of our readers have asked us to update our code to work with 0.6.1 (currently the newest version as of this writing) and several of you also sent me clues as to how to make the update. Thank you! Here are the changes needed to make the update:</p>

<script src="./An introduction to the Crafty game engine - Build New Games_files/8513544.js"></script><link rel="stylesheet" href="https://gist-assets.github.com/assets/embed-d1006a2c03378524a2bad8f05b286964.css"><div id="gist8513544" class="gist">
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-components-js-L1" rel="file-components-js-L1">1</span>
            <span class="line-number" id="file-components-js-L2" rel="file-components-js-L2">2</span>
            <span class="line-number" id="file-components-js-L3" rel="file-components-js-L3">3</span>
            <span class="line-number" id="file-components-js-L4" rel="file-components-js-L4">4</span>
            <span class="line-number" id="file-components-js-L5" rel="file-components-js-L5">5</span>
            <span class="line-number" id="file-components-js-L6" rel="file-components-js-L6">6</span>
            <span class="line-number" id="file-components-js-L7" rel="file-components-js-L7">7</span>
            <span class="line-number" id="file-components-js-L8" rel="file-components-js-L8">8</span>
            <span class="line-number" id="file-components-js-L9" rel="file-components-js-L9">9</span>
            <span class="line-number" id="file-components-js-L10" rel="file-components-js-L10">10</span>
            <span class="line-number" id="file-components-js-L11" rel="file-components-js-L11">11</span>
            <span class="line-number" id="file-components-js-L12" rel="file-components-js-L12">12</span>
            <span class="line-number" id="file-components-js-L13" rel="file-components-js-L13">13</span>
            <span class="line-number" id="file-components-js-L14" rel="file-components-js-L14">14</span>
            <span class="line-number" id="file-components-js-L15" rel="file-components-js-L15">15</span>
            <span class="line-number" id="file-components-js-L16" rel="file-components-js-L16">16</span>
            <span class="line-number" id="file-components-js-L17" rel="file-components-js-L17">17</span>
            <span class="line-number" id="file-components-js-L18" rel="file-components-js-L18">18</span>
            <span class="line-number" id="file-components-js-L19" rel="file-components-js-L19">19</span>
            <span class="line-number" id="file-components-js-L20" rel="file-components-js-L20">20</span>
            <span class="line-number" id="file-components-js-L21" rel="file-components-js-L21">21</span>
            <span class="line-number" id="file-components-js-L22" rel="file-components-js-L22">22</span>
            <span class="line-number" id="file-components-js-L23" rel="file-components-js-L23">23</span>
            <span class="line-number" id="file-components-js-L24" rel="file-components-js-L24">24</span>
            <span class="line-number" id="file-components-js-L25" rel="file-components-js-L25">25</span>
            <span class="line-number" id="file-components-js-L26" rel="file-components-js-L26">26</span>
            <span class="line-number" id="file-components-js-L27" rel="file-components-js-L27">27</span>
            <span class="line-number" id="file-components-js-L28" rel="file-components-js-L28">28</span>
            <span class="line-number" id="file-components-js-L29" rel="file-components-js-L29">29</span>
            <span class="line-number" id="file-components-js-L30" rel="file-components-js-L30">30</span>
            <span class="line-number" id="file-components-js-L31" rel="file-components-js-L31">31</span>
            <span class="line-number" id="file-components-js-L32" rel="file-components-js-L32">32</span>
            <span class="line-number" id="file-components-js-L33" rel="file-components-js-L33">33</span>
            <span class="line-number" id="file-components-js-L34" rel="file-components-js-L34">34</span>
            <span class="line-number" id="file-components-js-L35" rel="file-components-js-L35">35</span>
            <span class="line-number" id="file-components-js-L36" rel="file-components-js-L36">36</span>
            <span class="line-number" id="file-components-js-L37" rel="file-components-js-L37">37</span>
            <span class="line-number" id="file-components-js-L38" rel="file-components-js-L38">38</span>
            <span class="line-number" id="file-components-js-L39" rel="file-components-js-L39">39</span>
            <span class="line-number" id="file-components-js-L40" rel="file-components-js-L40">40</span>
            <span class="line-number" id="file-components-js-L41" rel="file-components-js-L41">41</span>
            <span class="line-number" id="file-components-js-L42" rel="file-components-js-L42">42</span>
            <span class="line-number" id="file-components-js-L43" rel="file-components-js-L43">43</span>
            <span class="line-number" id="file-components-js-L44" rel="file-components-js-L44">44</span>
            <span class="line-number" id="file-components-js-L45" rel="file-components-js-L45">45</span>
            <span class="line-number" id="file-components-js-L46" rel="file-components-js-L46">46</span>
            <span class="line-number" id="file-components-js-L47" rel="file-components-js-L47">47</span>
            <span class="line-number" id="file-components-js-L48" rel="file-components-js-L48">48</span>
            <span class="line-number" id="file-components-js-L49" rel="file-components-js-L49">49</span>
            <span class="line-number" id="file-components-js-L50" rel="file-components-js-L50">50</span>
            <span class="line-number" id="file-components-js-L51" rel="file-components-js-L51">51</span>
            <span class="line-number" id="file-components-js-L52" rel="file-components-js-L52">52</span>
            <span class="line-number" id="file-components-js-L53" rel="file-components-js-L53">53</span>
            <span class="line-number" id="file-components-js-L54" rel="file-components-js-L54">54</span>
            <span class="line-number" id="file-components-js-L55" rel="file-components-js-L55">55</span>
            <span class="line-number" id="file-components-js-L56" rel="file-components-js-L56">56</span>
            <span class="line-number" id="file-components-js-L57" rel="file-components-js-L57">57</span>
            <span class="line-number" id="file-components-js-L58" rel="file-components-js-L58">58</span>
            <span class="line-number" id="file-components-js-L59" rel="file-components-js-L59">59</span>
            <span class="line-number" id="file-components-js-L60" rel="file-components-js-L60">60</span>
            <span class="line-number" id="file-components-js-L61" rel="file-components-js-L61">61</span>
            <span class="line-number" id="file-components-js-L62" rel="file-components-js-L62">62</span>
            <span class="line-number" id="file-components-js-L63" rel="file-components-js-L63">63</span>
            <span class="line-number" id="file-components-js-L64" rel="file-components-js-L64">64</span>
            <span class="line-number" id="file-components-js-L65" rel="file-components-js-L65">65</span>
            <span class="line-number" id="file-components-js-L66" rel="file-components-js-L66">66</span>
            <span class="line-number" id="file-components-js-L67" rel="file-components-js-L67">67</span>
            <span class="line-number" id="file-components-js-L68" rel="file-components-js-L68">68</span>
            <span class="line-number" id="file-components-js-L69" rel="file-components-js-L69">69</span>
            <span class="line-number" id="file-components-js-L70" rel="file-components-js-L70">70</span>
            <span class="line-number" id="file-components-js-L71" rel="file-components-js-L71">71</span>
            <span class="line-number" id="file-components-js-L72" rel="file-components-js-L72">72</span>
            <span class="line-number" id="file-components-js-L73" rel="file-components-js-L73">73</span>
            <span class="line-number" id="file-components-js-L74" rel="file-components-js-L74">74</span>
            <span class="line-number" id="file-components-js-L75" rel="file-components-js-L75">75</span>
            <span class="line-number" id="file-components-js-L76" rel="file-components-js-L76">76</span>
            <span class="line-number" id="file-components-js-L77" rel="file-components-js-L77">77</span>
            <span class="line-number" id="file-components-js-L78" rel="file-components-js-L78">78</span>
            <span class="line-number" id="file-components-js-L79" rel="file-components-js-L79">79</span>
            <span class="line-number" id="file-components-js-L80" rel="file-components-js-L80">80</span>
            <span class="line-number" id="file-components-js-L81" rel="file-components-js-L81">81</span>
            <span class="line-number" id="file-components-js-L82" rel="file-components-js-L82">82</span>
            <span class="line-number" id="file-components-js-L83" rel="file-components-js-L83">83</span>
            <span class="line-number" id="file-components-js-L84" rel="file-components-js-L84">84</span>
            <span class="line-number" id="file-components-js-L85" rel="file-components-js-L85">85</span>
            <span class="line-number" id="file-components-js-L86" rel="file-components-js-L86">86</span>
            <span class="line-number" id="file-components-js-L87" rel="file-components-js-L87">87</span>
            <span class="line-number" id="file-components-js-L88" rel="file-components-js-L88">88</span>
            <span class="line-number" id="file-components-js-L89" rel="file-components-js-L89">89</span>
            <span class="line-number" id="file-components-js-L90" rel="file-components-js-L90">90</span>
            <span class="line-number" id="file-components-js-L91" rel="file-components-js-L91">91</span>
            <span class="line-number" id="file-components-js-L92" rel="file-components-js-L92">92</span>
            <span class="line-number" id="file-components-js-L93" rel="file-components-js-L93">93</span>
            <span class="line-number" id="file-components-js-L94" rel="file-components-js-L94">94</span>
            <span class="line-number" id="file-components-js-L95" rel="file-components-js-L95">95</span>
            <span class="line-number" id="file-components-js-L96" rel="file-components-js-L96">96</span>
            <span class="line-number" id="file-components-js-L97" rel="file-components-js-L97">97</span>
            <span class="line-number" id="file-components-js-L98" rel="file-components-js-L98">98</span>
            <span class="line-number" id="file-components-js-L99" rel="file-components-js-L99">99</span>
            <span class="line-number" id="file-components-js-L100" rel="file-components-js-L100">100</span>
            <span class="line-number" id="file-components-js-L101" rel="file-components-js-L101">101</span>
            <span class="line-number" id="file-components-js-L102" rel="file-components-js-L102">102</span>
            <span class="line-number" id="file-components-js-L103" rel="file-components-js-L103">103</span>
            <span class="line-number" id="file-components-js-L104" rel="file-components-js-L104">104</span>
            <span class="line-number" id="file-components-js-L105" rel="file-components-js-L105">105</span>
            <span class="line-number" id="file-components-js-L106" rel="file-components-js-L106">106</span>
            <span class="line-number" id="file-components-js-L107" rel="file-components-js-L107">107</span>
            <span class="line-number" id="file-components-js-L108" rel="file-components-js-L108">108</span>
            <span class="line-number" id="file-components-js-L109" rel="file-components-js-L109">109</span>
            <span class="line-number" id="file-components-js-L110" rel="file-components-js-L110">110</span>
            <span class="line-number" id="file-components-js-L111" rel="file-components-js-L111">111</span>
            <span class="line-number" id="file-components-js-L112" rel="file-components-js-L112">112</span>
            <span class="line-number" id="file-components-js-L113" rel="file-components-js-L113">113</span>
            <span class="line-number" id="file-components-js-L114" rel="file-components-js-L114">114</span>
            <span class="line-number" id="file-components-js-L115" rel="file-components-js-L115">115</span>
            <span class="line-number" id="file-components-js-L116" rel="file-components-js-L116">116</span>
            <span class="line-number" id="file-components-js-L117" rel="file-components-js-L117">117</span>
            <span class="line-number" id="file-components-js-L118" rel="file-components-js-L118">118</span>
            <span class="line-number" id="file-components-js-L119" rel="file-components-js-L119">119</span>
            <span class="line-number" id="file-components-js-L120" rel="file-components-js-L120">120</span>
            <span class="line-number" id="file-components-js-L121" rel="file-components-js-L121">121</span>
            <span class="line-number" id="file-components-js-L122" rel="file-components-js-L122">122</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-components-js-LC1"><span class="c1">// The Grid component allows an element to be located</span></div><div class="line" id="file-components-js-LC2"><span class="c1">//  on a grid of tiles</span></div><div class="line" id="file-components-js-LC3"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Grid'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC4">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC5">		<span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class="line" id="file-components-js-LC6">			<span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class="line" id="file-components-js-LC7">			<span class="nx">h</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span></div><div class="line" id="file-components-js-LC8">		<span class="p">});</span></div><div class="line" id="file-components-js-LC9">	<span class="p">},</span></div><div class="line" id="file-components-js-LC10">&nbsp;</div><div class="line" id="file-components-js-LC11">	<span class="c1">// Locate this entity at the given position on the grid</span></div><div class="line" id="file-components-js-LC12">	<span class="nx">at</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC13">		<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC14">			<span class="k">return</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">/</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">};</span></div><div class="line" id="file-components-js-LC15">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC16">			<span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span> <span class="p">});</span></div><div class="line" id="file-components-js-LC17">			<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC18">		<span class="p">}</span></div><div class="line" id="file-components-js-LC19">	<span class="p">}</span></div><div class="line" id="file-components-js-LC20"><span class="p">});</span></div><div class="line" id="file-components-js-LC21">&nbsp;</div><div class="line" id="file-components-js-LC22"><span class="c1">// An "Actor" is an entity that is drawn in 2D on canvas</span></div><div class="line" id="file-components-js-LC23"><span class="c1">//  via our logical coordinate grid</span></div><div class="line" id="file-components-js-LC24"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Actor'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC25">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC26">		<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'2D, Canvas, Grid'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC27">	<span class="p">},</span></div><div class="line" id="file-components-js-LC28"><span class="p">});</span></div><div class="line" id="file-components-js-LC29">&nbsp;</div><div class="line" id="file-components-js-LC30"><span class="c1">// A Tree is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC31"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC32">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC33">		<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_tree'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC34">	<span class="p">},</span></div><div class="line" id="file-components-js-LC35"><span class="p">});</span></div><div class="line" id="file-components-js-LC36">&nbsp;</div><div class="line" id="file-components-js-LC37"><span class="c1">// A Bush is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC38"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Bush'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC39">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC40">		<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_bush'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC41">	<span class="p">},</span></div><div class="line" id="file-components-js-LC42"><span class="p">});</span></div><div class="line" id="file-components-js-LC43">&nbsp;</div><div class="line" id="file-components-js-LC44"><span class="c1">// A Rock is just an Actor with a certain sprite</span></div><div class="line" id="file-components-js-LC45"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Rock'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC46">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC47">    <span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Solid, spr_rock'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC48">	<span class="p">},</span></div><div class="line" id="file-components-js-LC49"><span class="p">});</span></div><div class="line" id="file-components-js-LC50">&nbsp;</div><div class="line" id="file-components-js-LC51"><span class="c1">// This is the player-controlled character</span></div><div class="line" id="file-components-js-LC52"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC53">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC54">		<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, Fourway, Collision, spr_player, SpriteAnimation'</span><span class="p">)</span></div><div class="line" id="file-components-js-LC55">			<span class="p">.</span><span class="nx">fourway</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div><div class="line" id="file-components-js-LC56">			<span class="p">.</span><span class="nx">stopOnSolids</span><span class="p">()</span></div><div class="line" id="file-components-js-LC57">			<span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visitVillage</span><span class="p">)</span></div><div class="line" id="file-components-js-LC58">			<span class="c1">// These next lines define our four animations</span></div><div class="line" id="file-components-js-LC59">			<span class="c1">//  each call to .animate specifies:</span></div><div class="line" id="file-components-js-LC60">			<span class="c1">//  - the name of the animation</span></div><div class="line" id="file-components-js-LC61">			<span class="c1">//  - the x and y coordinates within the sprite</span></div><div class="line" id="file-components-js-LC62">			<span class="c1">//     map at which the animation set begins</span></div><div class="line" id="file-components-js-LC63">			<span class="c1">//  - the number of animation frames *in addition to* the first one</span></div><div class="line" id="file-components-js-LC64">			<span class="p">.</span><span class="nx">reel</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span>    <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div><div class="line" id="file-components-js-LC65">			<span class="p">.</span><span class="nx">reel</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div><div class="line" id="file-components-js-LC66">			<span class="p">.</span><span class="nx">reel</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span>  <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div><div class="line" id="file-components-js-LC67">			<span class="p">.</span><span class="nx">reel</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span>  <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></div><div class="line" id="file-components-js-LC68">&nbsp;</div><div class="line" id="file-components-js-LC69">		<span class="c1">// Watch for a change of direction and switch animations accordingly</span></div><div class="line" id="file-components-js-LC70">		<span class="kd">var</span> <span class="nx">animation_speed</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span></div><div class="line" id="file-components-js-LC71">		<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'NewDirection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC72">			<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC73">				<span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingRight'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC74">			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC75">				<span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingLeft'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC76">			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC77">				<span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingDown'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC78">			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC79">				<span class="k">this</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'PlayerMovingUp'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class="line" id="file-components-js-LC80">			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC81">				<span class="k">this</span><span class="p">.</span><span class="nx">pauseAnimation</span><span class="p">();</span></div><div class="line" id="file-components-js-LC82">			<span class="p">}</span></div><div class="line" id="file-components-js-LC83">		<span class="p">});</span></div><div class="line" id="file-components-js-LC84">	<span class="p">},</span></div><div class="line" id="file-components-js-LC85">&nbsp;</div><div class="line" id="file-components-js-LC86">	<span class="c1">// Registers a stop-movement function to be called when</span></div><div class="line" id="file-components-js-LC87">	<span class="c1">//  this entity hits an entity with the "Solid" component</span></div><div class="line" id="file-components-js-LC88">	<span class="nx">stopOnSolids</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC89">		<span class="k">this</span><span class="p">.</span><span class="nx">onHit</span><span class="p">(</span><span class="s1">'Solid'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stopMovement</span><span class="p">);</span></div><div class="line" id="file-components-js-LC90">&nbsp;</div><div class="line" id="file-components-js-LC91">		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class="line" id="file-components-js-LC92">	<span class="p">},</span></div><div class="line" id="file-components-js-LC93">&nbsp;</div><div class="line" id="file-components-js-LC94">	<span class="c1">// Stops the movement</span></div><div class="line" id="file-components-js-LC95">	<span class="nx">stopMovement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC96">		<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class="line" id="file-components-js-LC97">		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC98">			<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class="line" id="file-components-js-LC99">			<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class="line" id="file-components-js-LC100">		<span class="p">}</span></div><div class="line" id="file-components-js-LC101">	<span class="p">},</span></div><div class="line" id="file-components-js-LC102">&nbsp;</div><div class="line" id="file-components-js-LC103">	<span class="c1">// Respond to this player visiting a village</span></div><div class="line" id="file-components-js-LC104">	<span class="nx">visitVillage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC105">		<span class="nx">villlage</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">obj</span><span class="p">;</span></div><div class="line" id="file-components-js-LC106">		<span class="nx">villlage</span><span class="p">.</span><span class="nx">visit</span><span class="p">();</span></div><div class="line" id="file-components-js-LC107">	<span class="p">}</span></div><div class="line" id="file-components-js-LC108"><span class="p">});</span></div><div class="line" id="file-components-js-LC109">&nbsp;</div><div class="line" id="file-components-js-LC110"><span class="c1">// A village is a tile on the grid that the PC must visit in order to win the game</span></div><div class="line" id="file-components-js-LC111"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC112">	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC113">		<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">'Actor, spr_village'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC114">	<span class="p">},</span></div><div class="line" id="file-components-js-LC115">&nbsp;</div><div class="line" id="file-components-js-LC116">	<span class="c1">// Process a visitation with this village</span></div><div class="line" id="file-components-js-LC117">	<span class="nx">visit</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-components-js-LC118">		<span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class="line" id="file-components-js-LC119">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'knock'</span><span class="p">);</span></div><div class="line" id="file-components-js-LC120">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span></div><div class="line" id="file-components-js-LC121">	<span class="p">}</span></div><div class="line" id="file-components-js-LC122"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/8513544/raw/components.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/8513544#file-components-js">components.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-game-js-L1" rel="file-game-js-L1">1</span>
            <span class="line-number" id="file-game-js-L2" rel="file-game-js-L2">2</span>
            <span class="line-number" id="file-game-js-L3" rel="file-game-js-L3">3</span>
            <span class="line-number" id="file-game-js-L4" rel="file-game-js-L4">4</span>
            <span class="line-number" id="file-game-js-L5" rel="file-game-js-L5">5</span>
            <span class="line-number" id="file-game-js-L6" rel="file-game-js-L6">6</span>
            <span class="line-number" id="file-game-js-L7" rel="file-game-js-L7">7</span>
            <span class="line-number" id="file-game-js-L8" rel="file-game-js-L8">8</span>
            <span class="line-number" id="file-game-js-L9" rel="file-game-js-L9">9</span>
            <span class="line-number" id="file-game-js-L10" rel="file-game-js-L10">10</span>
            <span class="line-number" id="file-game-js-L11" rel="file-game-js-L11">11</span>
            <span class="line-number" id="file-game-js-L12" rel="file-game-js-L12">12</span>
            <span class="line-number" id="file-game-js-L13" rel="file-game-js-L13">13</span>
            <span class="line-number" id="file-game-js-L14" rel="file-game-js-L14">14</span>
            <span class="line-number" id="file-game-js-L15" rel="file-game-js-L15">15</span>
            <span class="line-number" id="file-game-js-L16" rel="file-game-js-L16">16</span>
            <span class="line-number" id="file-game-js-L17" rel="file-game-js-L17">17</span>
            <span class="line-number" id="file-game-js-L18" rel="file-game-js-L18">18</span>
            <span class="line-number" id="file-game-js-L19" rel="file-game-js-L19">19</span>
            <span class="line-number" id="file-game-js-L20" rel="file-game-js-L20">20</span>
            <span class="line-number" id="file-game-js-L21" rel="file-game-js-L21">21</span>
            <span class="line-number" id="file-game-js-L22" rel="file-game-js-L22">22</span>
            <span class="line-number" id="file-game-js-L23" rel="file-game-js-L23">23</span>
            <span class="line-number" id="file-game-js-L24" rel="file-game-js-L24">24</span>
            <span class="line-number" id="file-game-js-L25" rel="file-game-js-L25">25</span>
            <span class="line-number" id="file-game-js-L26" rel="file-game-js-L26">26</span>
            <span class="line-number" id="file-game-js-L27" rel="file-game-js-L27">27</span>
            <span class="line-number" id="file-game-js-L28" rel="file-game-js-L28">28</span>
            <span class="line-number" id="file-game-js-L29" rel="file-game-js-L29">29</span>
            <span class="line-number" id="file-game-js-L30" rel="file-game-js-L30">30</span>
            <span class="line-number" id="file-game-js-L31" rel="file-game-js-L31">31</span>
            <span class="line-number" id="file-game-js-L32" rel="file-game-js-L32">32</span>
            <span class="line-number" id="file-game-js-L33" rel="file-game-js-L33">33</span>
            <span class="line-number" id="file-game-js-L34" rel="file-game-js-L34">34</span>
            <span class="line-number" id="file-game-js-L35" rel="file-game-js-L35">35</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-game-js-LC1"><span class="nx">Game</span> <span class="o">=</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC2">	<span class="c1">// This defines our grid's size and the size of each of its tiles</span></div><div class="line" id="file-game-js-LC3">	<span class="nx">map_grid</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC4">		<span class="nx">width</span><span class="o">:</span>  <span class="mi">24</span><span class="p">,</span></div><div class="line" id="file-game-js-LC5">		<span class="nx">height</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC6">		<span class="nx">tile</span><span class="o">:</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC7">			<span class="nx">width</span><span class="o">:</span>  <span class="mi">16</span><span class="p">,</span></div><div class="line" id="file-game-js-LC8">			<span class="nx">height</span><span class="o">:</span> <span class="mi">16</span></div><div class="line" id="file-game-js-LC9">		<span class="p">}</span></div><div class="line" id="file-game-js-LC10">	<span class="p">},</span></div><div class="line" id="file-game-js-LC11">&nbsp;</div><div class="line" id="file-game-js-LC12">	<span class="c1">// The total width of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC13">	<span class="c1">//  this is just the width of a tile times the width of the grid</span></div><div class="line" id="file-game-js-LC14">	<span class="nx">width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC15">		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class="line" id="file-game-js-LC16">	<span class="p">},</span></div><div class="line" id="file-game-js-LC17">&nbsp;</div><div class="line" id="file-game-js-LC18">	<span class="c1">// The total height of the game screen. Since our grid takes up the entire screen</span></div><div class="line" id="file-game-js-LC19">	<span class="c1">//  this is just the height of a tile times the height of the grid</span></div><div class="line" id="file-game-js-LC20">	<span class="nx">height</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC21">		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class="line" id="file-game-js-LC22">	<span class="p">},</span></div><div class="line" id="file-game-js-LC23">&nbsp;</div><div class="line" id="file-game-js-LC24">	<span class="c1">// Initialize and start our game</span></div><div class="line" id="file-game-js-LC25">	<span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-game-js-LC26">		<span class="c1">// Start crafty and set a background color so that we can see it's working</span></div><div class="line" id="file-game-js-LC27">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">());</span></div><div class="line" id="file-game-js-LC28">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="s1">'rgb(87, 109, 20)'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC29">&nbsp;</div><div class="line" id="file-game-js-LC30">		<span class="c1">// Simply start the "Loading" scene to get things going</span></div><div class="line" id="file-game-js-LC31">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">);</span></div><div class="line" id="file-game-js-LC32">	<span class="p">}</span></div><div class="line" id="file-game-js-LC33"><span class="p">};</span></div><div class="line" id="file-game-js-LC34">&nbsp;</div><div class="line" id="file-game-js-LC35"><span class="nx">$text_css</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'size'</span><span class="o">:</span> <span class="s1">'24px'</span><span class="p">,</span> <span class="s1">'family'</span><span class="o">:</span> <span class="s1">'Arial'</span><span class="p">,</span> <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'text-align'</span><span class="o">:</span> <span class="s1">'center'</span> <span class="p">};</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/8513544/raw/game.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/8513544#file-game-js">game.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
        <div class="gist-file">
          <div class="gist-data gist-syntax">
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tbody><tr>
          <td class="line-numbers">
            <span class="line-number" id="file-scenes-js-L1" rel="file-scenes-js-L1">1</span>
            <span class="line-number" id="file-scenes-js-L2" rel="file-scenes-js-L2">2</span>
            <span class="line-number" id="file-scenes-js-L3" rel="file-scenes-js-L3">3</span>
            <span class="line-number" id="file-scenes-js-L4" rel="file-scenes-js-L4">4</span>
            <span class="line-number" id="file-scenes-js-L5" rel="file-scenes-js-L5">5</span>
            <span class="line-number" id="file-scenes-js-L6" rel="file-scenes-js-L6">6</span>
            <span class="line-number" id="file-scenes-js-L7" rel="file-scenes-js-L7">7</span>
            <span class="line-number" id="file-scenes-js-L8" rel="file-scenes-js-L8">8</span>
            <span class="line-number" id="file-scenes-js-L9" rel="file-scenes-js-L9">9</span>
            <span class="line-number" id="file-scenes-js-L10" rel="file-scenes-js-L10">10</span>
            <span class="line-number" id="file-scenes-js-L11" rel="file-scenes-js-L11">11</span>
            <span class="line-number" id="file-scenes-js-L12" rel="file-scenes-js-L12">12</span>
            <span class="line-number" id="file-scenes-js-L13" rel="file-scenes-js-L13">13</span>
            <span class="line-number" id="file-scenes-js-L14" rel="file-scenes-js-L14">14</span>
            <span class="line-number" id="file-scenes-js-L15" rel="file-scenes-js-L15">15</span>
            <span class="line-number" id="file-scenes-js-L16" rel="file-scenes-js-L16">16</span>
            <span class="line-number" id="file-scenes-js-L17" rel="file-scenes-js-L17">17</span>
            <span class="line-number" id="file-scenes-js-L18" rel="file-scenes-js-L18">18</span>
            <span class="line-number" id="file-scenes-js-L19" rel="file-scenes-js-L19">19</span>
            <span class="line-number" id="file-scenes-js-L20" rel="file-scenes-js-L20">20</span>
            <span class="line-number" id="file-scenes-js-L21" rel="file-scenes-js-L21">21</span>
            <span class="line-number" id="file-scenes-js-L22" rel="file-scenes-js-L22">22</span>
            <span class="line-number" id="file-scenes-js-L23" rel="file-scenes-js-L23">23</span>
            <span class="line-number" id="file-scenes-js-L24" rel="file-scenes-js-L24">24</span>
            <span class="line-number" id="file-scenes-js-L25" rel="file-scenes-js-L25">25</span>
            <span class="line-number" id="file-scenes-js-L26" rel="file-scenes-js-L26">26</span>
            <span class="line-number" id="file-scenes-js-L27" rel="file-scenes-js-L27">27</span>
            <span class="line-number" id="file-scenes-js-L28" rel="file-scenes-js-L28">28</span>
            <span class="line-number" id="file-scenes-js-L29" rel="file-scenes-js-L29">29</span>
            <span class="line-number" id="file-scenes-js-L30" rel="file-scenes-js-L30">30</span>
            <span class="line-number" id="file-scenes-js-L31" rel="file-scenes-js-L31">31</span>
            <span class="line-number" id="file-scenes-js-L32" rel="file-scenes-js-L32">32</span>
            <span class="line-number" id="file-scenes-js-L33" rel="file-scenes-js-L33">33</span>
            <span class="line-number" id="file-scenes-js-L34" rel="file-scenes-js-L34">34</span>
            <span class="line-number" id="file-scenes-js-L35" rel="file-scenes-js-L35">35</span>
            <span class="line-number" id="file-scenes-js-L36" rel="file-scenes-js-L36">36</span>
            <span class="line-number" id="file-scenes-js-L37" rel="file-scenes-js-L37">37</span>
            <span class="line-number" id="file-scenes-js-L38" rel="file-scenes-js-L38">38</span>
            <span class="line-number" id="file-scenes-js-L39" rel="file-scenes-js-L39">39</span>
            <span class="line-number" id="file-scenes-js-L40" rel="file-scenes-js-L40">40</span>
            <span class="line-number" id="file-scenes-js-L41" rel="file-scenes-js-L41">41</span>
            <span class="line-number" id="file-scenes-js-L42" rel="file-scenes-js-L42">42</span>
            <span class="line-number" id="file-scenes-js-L43" rel="file-scenes-js-L43">43</span>
            <span class="line-number" id="file-scenes-js-L44" rel="file-scenes-js-L44">44</span>
            <span class="line-number" id="file-scenes-js-L45" rel="file-scenes-js-L45">45</span>
            <span class="line-number" id="file-scenes-js-L46" rel="file-scenes-js-L46">46</span>
            <span class="line-number" id="file-scenes-js-L47" rel="file-scenes-js-L47">47</span>
            <span class="line-number" id="file-scenes-js-L48" rel="file-scenes-js-L48">48</span>
            <span class="line-number" id="file-scenes-js-L49" rel="file-scenes-js-L49">49</span>
            <span class="line-number" id="file-scenes-js-L50" rel="file-scenes-js-L50">50</span>
            <span class="line-number" id="file-scenes-js-L51" rel="file-scenes-js-L51">51</span>
            <span class="line-number" id="file-scenes-js-L52" rel="file-scenes-js-L52">52</span>
            <span class="line-number" id="file-scenes-js-L53" rel="file-scenes-js-L53">53</span>
            <span class="line-number" id="file-scenes-js-L54" rel="file-scenes-js-L54">54</span>
            <span class="line-number" id="file-scenes-js-L55" rel="file-scenes-js-L55">55</span>
            <span class="line-number" id="file-scenes-js-L56" rel="file-scenes-js-L56">56</span>
            <span class="line-number" id="file-scenes-js-L57" rel="file-scenes-js-L57">57</span>
            <span class="line-number" id="file-scenes-js-L58" rel="file-scenes-js-L58">58</span>
            <span class="line-number" id="file-scenes-js-L59" rel="file-scenes-js-L59">59</span>
            <span class="line-number" id="file-scenes-js-L60" rel="file-scenes-js-L60">60</span>
            <span class="line-number" id="file-scenes-js-L61" rel="file-scenes-js-L61">61</span>
            <span class="line-number" id="file-scenes-js-L62" rel="file-scenes-js-L62">62</span>
            <span class="line-number" id="file-scenes-js-L63" rel="file-scenes-js-L63">63</span>
            <span class="line-number" id="file-scenes-js-L64" rel="file-scenes-js-L64">64</span>
            <span class="line-number" id="file-scenes-js-L65" rel="file-scenes-js-L65">65</span>
            <span class="line-number" id="file-scenes-js-L66" rel="file-scenes-js-L66">66</span>
            <span class="line-number" id="file-scenes-js-L67" rel="file-scenes-js-L67">67</span>
            <span class="line-number" id="file-scenes-js-L68" rel="file-scenes-js-L68">68</span>
            <span class="line-number" id="file-scenes-js-L69" rel="file-scenes-js-L69">69</span>
            <span class="line-number" id="file-scenes-js-L70" rel="file-scenes-js-L70">70</span>
            <span class="line-number" id="file-scenes-js-L71" rel="file-scenes-js-L71">71</span>
            <span class="line-number" id="file-scenes-js-L72" rel="file-scenes-js-L72">72</span>
            <span class="line-number" id="file-scenes-js-L73" rel="file-scenes-js-L73">73</span>
            <span class="line-number" id="file-scenes-js-L74" rel="file-scenes-js-L74">74</span>
            <span class="line-number" id="file-scenes-js-L75" rel="file-scenes-js-L75">75</span>
            <span class="line-number" id="file-scenes-js-L76" rel="file-scenes-js-L76">76</span>
            <span class="line-number" id="file-scenes-js-L77" rel="file-scenes-js-L77">77</span>
            <span class="line-number" id="file-scenes-js-L78" rel="file-scenes-js-L78">78</span>
            <span class="line-number" id="file-scenes-js-L79" rel="file-scenes-js-L79">79</span>
            <span class="line-number" id="file-scenes-js-L80" rel="file-scenes-js-L80">80</span>
            <span class="line-number" id="file-scenes-js-L81" rel="file-scenes-js-L81">81</span>
            <span class="line-number" id="file-scenes-js-L82" rel="file-scenes-js-L82">82</span>
            <span class="line-number" id="file-scenes-js-L83" rel="file-scenes-js-L83">83</span>
            <span class="line-number" id="file-scenes-js-L84" rel="file-scenes-js-L84">84</span>
            <span class="line-number" id="file-scenes-js-L85" rel="file-scenes-js-L85">85</span>
            <span class="line-number" id="file-scenes-js-L86" rel="file-scenes-js-L86">86</span>
            <span class="line-number" id="file-scenes-js-L87" rel="file-scenes-js-L87">87</span>
            <span class="line-number" id="file-scenes-js-L88" rel="file-scenes-js-L88">88</span>
            <span class="line-number" id="file-scenes-js-L89" rel="file-scenes-js-L89">89</span>
            <span class="line-number" id="file-scenes-js-L90" rel="file-scenes-js-L90">90</span>
            <span class="line-number" id="file-scenes-js-L91" rel="file-scenes-js-L91">91</span>
            <span class="line-number" id="file-scenes-js-L92" rel="file-scenes-js-L92">92</span>
            <span class="line-number" id="file-scenes-js-L93" rel="file-scenes-js-L93">93</span>
            <span class="line-number" id="file-scenes-js-L94" rel="file-scenes-js-L94">94</span>
            <span class="line-number" id="file-scenes-js-L95" rel="file-scenes-js-L95">95</span>
            <span class="line-number" id="file-scenes-js-L96" rel="file-scenes-js-L96">96</span>
            <span class="line-number" id="file-scenes-js-L97" rel="file-scenes-js-L97">97</span>
            <span class="line-number" id="file-scenes-js-L98" rel="file-scenes-js-L98">98</span>
            <span class="line-number" id="file-scenes-js-L99" rel="file-scenes-js-L99">99</span>
            <span class="line-number" id="file-scenes-js-L100" rel="file-scenes-js-L100">100</span>
            <span class="line-number" id="file-scenes-js-L101" rel="file-scenes-js-L101">101</span>
            <span class="line-number" id="file-scenes-js-L102" rel="file-scenes-js-L102">102</span>
            <span class="line-number" id="file-scenes-js-L103" rel="file-scenes-js-L103">103</span>
            <span class="line-number" id="file-scenes-js-L104" rel="file-scenes-js-L104">104</span>
            <span class="line-number" id="file-scenes-js-L105" rel="file-scenes-js-L105">105</span>
            <span class="line-number" id="file-scenes-js-L106" rel="file-scenes-js-L106">106</span>
            <span class="line-number" id="file-scenes-js-L107" rel="file-scenes-js-L107">107</span>
            <span class="line-number" id="file-scenes-js-L108" rel="file-scenes-js-L108">108</span>
            <span class="line-number" id="file-scenes-js-L109" rel="file-scenes-js-L109">109</span>
            <span class="line-number" id="file-scenes-js-L110" rel="file-scenes-js-L110">110</span>
            <span class="line-number" id="file-scenes-js-L111" rel="file-scenes-js-L111">111</span>
            <span class="line-number" id="file-scenes-js-L112" rel="file-scenes-js-L112">112</span>
            <span class="line-number" id="file-scenes-js-L113" rel="file-scenes-js-L113">113</span>
            <span class="line-number" id="file-scenes-js-L114" rel="file-scenes-js-L114">114</span>
            <span class="line-number" id="file-scenes-js-L115" rel="file-scenes-js-L115">115</span>
            <span class="line-number" id="file-scenes-js-L116" rel="file-scenes-js-L116">116</span>
            <span class="line-number" id="file-scenes-js-L117" rel="file-scenes-js-L117">117</span>
            <span class="line-number" id="file-scenes-js-L118" rel="file-scenes-js-L118">118</span>
            <span class="line-number" id="file-scenes-js-L119" rel="file-scenes-js-L119">119</span>
            <span class="line-number" id="file-scenes-js-L120" rel="file-scenes-js-L120">120</span>
            <span class="line-number" id="file-scenes-js-L121" rel="file-scenes-js-L121">121</span>
            <span class="line-number" id="file-scenes-js-L122" rel="file-scenes-js-L122">122</span>
            <span class="line-number" id="file-scenes-js-L123" rel="file-scenes-js-L123">123</span>
            <span class="line-number" id="file-scenes-js-L124" rel="file-scenes-js-L124">124</span>
            <span class="line-number" id="file-scenes-js-L125" rel="file-scenes-js-L125">125</span>
            <span class="line-number" id="file-scenes-js-L126" rel="file-scenes-js-L126">126</span>
            <span class="line-number" id="file-scenes-js-L127" rel="file-scenes-js-L127">127</span>
            <span class="line-number" id="file-scenes-js-L128" rel="file-scenes-js-L128">128</span>
            <span class="line-number" id="file-scenes-js-L129" rel="file-scenes-js-L129">129</span>
            <span class="line-number" id="file-scenes-js-L130" rel="file-scenes-js-L130">130</span>
            <span class="line-number" id="file-scenes-js-L131" rel="file-scenes-js-L131">131</span>
            <span class="line-number" id="file-scenes-js-L132" rel="file-scenes-js-L132">132</span>
            <span class="line-number" id="file-scenes-js-L133" rel="file-scenes-js-L133">133</span>
            <span class="line-number" id="file-scenes-js-L134" rel="file-scenes-js-L134">134</span>
            <span class="line-number" id="file-scenes-js-L135" rel="file-scenes-js-L135">135</span>
            <span class="line-number" id="file-scenes-js-L136" rel="file-scenes-js-L136">136</span>
            <span class="line-number" id="file-scenes-js-L137" rel="file-scenes-js-L137">137</span>
            <span class="line-number" id="file-scenes-js-L138" rel="file-scenes-js-L138">138</span>
            <span class="line-number" id="file-scenes-js-L139" rel="file-scenes-js-L139">139</span>
            <span class="line-number" id="file-scenes-js-L140" rel="file-scenes-js-L140">140</span>
            <span class="line-number" id="file-scenes-js-L141" rel="file-scenes-js-L141">141</span>
            <span class="line-number" id="file-scenes-js-L142" rel="file-scenes-js-L142">142</span>
            <span class="line-number" id="file-scenes-js-L143" rel="file-scenes-js-L143">143</span>
            <span class="line-number" id="file-scenes-js-L144" rel="file-scenes-js-L144">144</span>
            <span class="line-number" id="file-scenes-js-L145" rel="file-scenes-js-L145">145</span>
            <span class="line-number" id="file-scenes-js-L146" rel="file-scenes-js-L146">146</span>
            <span class="line-number" id="file-scenes-js-L147" rel="file-scenes-js-L147">147</span>
            <span class="line-number" id="file-scenes-js-L148" rel="file-scenes-js-L148">148</span>
            <span class="line-number" id="file-scenes-js-L149" rel="file-scenes-js-L149">149</span>
            <span class="line-number" id="file-scenes-js-L150" rel="file-scenes-js-L150">150</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-scenes-js-LC1"><span class="c1">// Game scene</span></div><div class="line" id="file-scenes-js-LC2"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC3"><span class="c1">// Runs the core gameplay loop</span></div><div class="line" id="file-scenes-js-LC4"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC5">	<span class="c1">// A 2D array to keep track of all occupied tiles</span></div><div class="line" id="file-scenes-js-LC6">	<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC7">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC8">		<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC9">		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC10">			<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC11">		<span class="p">}</span></div><div class="line" id="file-scenes-js-LC12">	<span class="p">}</span></div><div class="line" id="file-scenes-js-LC13">&nbsp;</div><div class="line" id="file-scenes-js-LC14">	<span class="c1">// Player character, placed at 5, 5 on our grid</span></div><div class="line" id="file-scenes-js-LC15">	<span class="k">this</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'PlayerCharacter'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC16">	<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">x</span><span class="p">][</span><span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">at</span><span class="p">().</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC17">&nbsp;</div><div class="line" id="file-scenes-js-LC18">	<span class="c1">// Place a tree at every edge square on our grid of 16x16 tiles</span></div><div class="line" id="file-scenes-js-LC19">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC20">		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC21">			<span class="kd">var</span> <span class="nx">at_edge</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC22">&nbsp;</div><div class="line" id="file-scenes-js-LC23">			<span class="k">if</span> <span class="p">(</span><span class="nx">at_edge</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC24">				<span class="c1">// Place a tree entity at the current tile</span></div><div class="line" id="file-scenes-js-LC25">				<span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Tree'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC26">				<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC27">			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.06</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC28">				<span class="c1">// Place a bush entity at the current tile</span></div><div class="line" id="file-scenes-js-LC29">				<span class="kd">var</span> <span class="nx">bush_or_rock</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'Bush'</span> <span class="o">:</span> <span class="s1">'Rock'</span></div><div class="line" id="file-scenes-js-LC30">				<span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">bush_or_rock</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC31">				<span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC32">			<span class="p">}</span></div><div class="line" id="file-scenes-js-LC33">		<span class="p">}</span></div><div class="line" id="file-scenes-js-LC34">	<span class="p">}</span></div><div class="line" id="file-scenes-js-LC35">&nbsp;</div><div class="line" id="file-scenes-js-LC36">	<span class="c1">// Generate five villages on the map in random locations</span></div><div class="line" id="file-scenes-js-LC37">	<span class="kd">var</span> <span class="nx">max_villages</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC38">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC39">		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">map_grid</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC40">			<span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC41">				<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">max_villages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">occupied</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">])</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC42">					<span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC43">				<span class="p">}</span></div><div class="line" id="file-scenes-js-LC44">			<span class="p">}</span></div><div class="line" id="file-scenes-js-LC45">		<span class="p">}</span></div><div class="line" id="file-scenes-js-LC46">	<span class="p">}</span></div><div class="line" id="file-scenes-js-LC47">&nbsp;</div><div class="line" id="file-scenes-js-LC48">	<span class="c1">// Play a ringing sound to indicate the start of the journey</span></div><div class="line" id="file-scenes-js-LC49">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'ring'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC50">&nbsp;</div><div class="line" id="file-scenes-js-LC51">	<span class="c1">// Show the victory screen once all villages are visisted</span></div><div class="line" id="file-scenes-js-LC52">	<span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC53">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">(</span><span class="s1">'Village'</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC54">			<span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC55">		<span class="p">}</span></div><div class="line" id="file-scenes-js-LC56">	<span class="p">});</span></div><div class="line" id="file-scenes-js-LC57"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC58">	<span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC59">	<span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC60">	<span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC61">	<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'VillageVisited'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">show_victory</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC62"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC63">&nbsp;</div><div class="line" id="file-scenes-js-LC64">&nbsp;</div><div class="line" id="file-scenes-js-LC65"><span class="c1">// Victory scene</span></div><div class="line" id="file-scenes-js-LC66"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC67"><span class="c1">// Tells the player when they've won and lets them start a new game</span></div><div class="line" id="file-scenes-js-LC68"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Victory'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC69">	<span class="c1">// Display some text in celebration of the victory</span></div><div class="line" id="file-scenes-js-LC70">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC71">		<span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'All villages visited!'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC72">		<span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC73">		<span class="p">.</span><span class="nx">textFont</span><span class="p">(</span><span class="nx">$text_css</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC74">&nbsp;</div><div class="line" id="file-scenes-js-LC75">	<span class="c1">// Give'em a round of applause!</span></div><div class="line" id="file-scenes-js-LC76">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'applause'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC77">&nbsp;</div><div class="line" id="file-scenes-js-LC78">	<span class="c1">// After a short delay, watch for the player to press a key, then restart</span></div><div class="line" id="file-scenes-js-LC79">	<span class="c1">// the game when a key is pressed</span></div><div class="line" id="file-scenes-js-LC80">	<span class="kd">var</span> <span class="nx">delay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class="line" id="file-scenes-js-LC81">	<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">delay</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC82">	<span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC83">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC84">			<span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC85">		<span class="p">}</span></div><div class="line" id="file-scenes-js-LC86">	<span class="p">};</span></div><div class="line" id="file-scenes-js-LC87">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC88"><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC89">	<span class="c1">// Remove our event binding from above so that we don't</span></div><div class="line" id="file-scenes-js-LC90">	<span class="c1">//  end up having multiple redundant event watchers after</span></div><div class="line" id="file-scenes-js-LC91">	<span class="c1">//  multiple restarts of the game</span></div><div class="line" id="file-scenes-js-LC92">	<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">'KeyDown'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">restart_game</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC93"><span class="p">});</span></div><div class="line" id="file-scenes-js-LC94">&nbsp;</div><div class="line" id="file-scenes-js-LC95"><span class="c1">// Loading scene</span></div><div class="line" id="file-scenes-js-LC96"><span class="c1">// -------------</span></div><div class="line" id="file-scenes-js-LC97"><span class="c1">// Handles the loading of binary assets such as images and audio files</span></div><div class="line" id="file-scenes-js-LC98"><span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Loading'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC99">	<span class="c1">// Draw some text for the player to see in case the file</span></div><div class="line" id="file-scenes-js-LC100">	<span class="c1">//  takes a noticeable amount of time to load</span></div><div class="line" id="file-scenes-js-LC101">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s1">'2D, DOM, Text'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC102">		<span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'Loading; please wait...'</span><span class="p">)</span></div><div class="line" id="file-scenes-js-LC103">		<span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">24</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="p">})</span></div><div class="line" id="file-scenes-js-LC104">		<span class="p">.</span><span class="nx">textFont</span><span class="p">(</span><span class="nx">$text_css</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC105">&nbsp;</div><div class="line" id="file-scenes-js-LC106">	<span class="c1">// Load our sprite map image</span></div><div class="line" id="file-scenes-js-LC107">	<span class="nx">Crafty</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span></div><div class="line" id="file-scenes-js-LC108">		<span class="s1">'assets/16x16_forest_2.gif'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC109">		<span class="s1">'assets/hunter.png'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC110">		<span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC111">		<span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC112">		<span class="s1">'assets/door_knock_3x.aac'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC113">		<span class="s1">'assets/board_room_applause.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC114">		<span class="s1">'assets/board_room_applause.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC115">		<span class="s1">'assets/board_room_applause.aac'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC116">		<span class="s1">'assets/candy_dish_lid.mp3'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC117">		<span class="s1">'assets/candy_dish_lid.ogg'</span><span class="p">,</span></div><div class="line" id="file-scenes-js-LC118">		<span class="s1">'assets/candy_dish_lid.aac'</span></div><div class="line" id="file-scenes-js-LC119">		<span class="p">],</span> <span class="kd">function</span><span class="p">(){</span></div><div class="line" id="file-scenes-js-LC120">		<span class="c1">// Once the images are loaded...</span></div><div class="line" id="file-scenes-js-LC121">&nbsp;</div><div class="line" id="file-scenes-js-LC122">		<span class="c1">// Define the individual sprites in the image</span></div><div class="line" id="file-scenes-js-LC123">		<span class="c1">// Each one (spr_tree, etc.) becomes a component</span></div><div class="line" id="file-scenes-js-LC124">		<span class="c1">// These components' names are prefixed with "spr_"</span></div><div class="line" id="file-scenes-js-LC125">		<span class="c1">//  to remind us that they simply cause the entity</span></div><div class="line" id="file-scenes-js-LC126">		<span class="c1">//  to be drawn with a certain sprite</span></div><div class="line" id="file-scenes-js-LC127">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/16x16_forest_2.gif'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC128">			<span class="nx">spr_tree</span><span class="o">:</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC129">			<span class="nx">spr_bush</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC130">			<span class="nx">spr_village</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC131">			<span class="nx">spr_rock</span><span class="o">:</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC132">		<span class="p">});</span></div><div class="line" id="file-scenes-js-LC133">&nbsp;</div><div class="line" id="file-scenes-js-LC134">		<span class="c1">// Define the PC's sprite to be the first sprite in the third row of the</span></div><div class="line" id="file-scenes-js-LC135">		<span class="c1">//  animation sprite map</span></div><div class="line" id="file-scenes-js-LC136">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">'assets/hunter.png'</span><span class="p">,</span> <span class="p">{</span></div><div class="line" id="file-scenes-js-LC137">			<span class="nx">spr_player</span><span class="o">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC138">		<span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC139">&nbsp;</div><div class="line" id="file-scenes-js-LC140">		<span class="c1">// Define our sounds for later use</span></div><div class="line" id="file-scenes-js-LC141">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span></div><div class="line" id="file-scenes-js-LC142">			<span class="nx">knock</span><span class="o">:</span>    <span class="p">[</span><span class="s1">'assets/door_knock_3x.mp3'</span><span class="p">,</span> <span class="s1">'assets/door_knock_3x.ogg'</span><span class="p">,</span> <span class="s1">'assets/door_knock_3x.aac'</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC143">			<span class="nx">applause</span><span class="o">:</span> <span class="p">[</span><span class="s1">'assets/board_room_applause.mp3'</span><span class="p">,</span> <span class="s1">'assets/board_room_applause.ogg'</span><span class="p">,</span> <span class="s1">'assets/board_room_applause.aac'</span><span class="p">],</span></div><div class="line" id="file-scenes-js-LC144">			<span class="nx">ring</span><span class="o">:</span>     <span class="p">[</span><span class="s1">'assets/candy_dish_lid.mp3'</span><span class="p">,</span> <span class="s1">'assets/candy_dish_lid.ogg'</span><span class="p">,</span> <span class="s1">'assets/candy_dish_lid.aac'</span><span class="p">]</span></div><div class="line" id="file-scenes-js-LC145">		<span class="p">});</span></div><div class="line" id="file-scenes-js-LC146">&nbsp;</div><div class="line" id="file-scenes-js-LC147">		<span class="c1">// Now that our sprites are ready to draw, start the game</span></div><div class="line" id="file-scenes-js-LC148">		<span class="nx">Crafty</span><span class="p">.</span><span class="nx">scene</span><span class="p">(</span><span class="s1">'Game'</span><span class="p">);</span></div><div class="line" id="file-scenes-js-LC149">	<span class="p">});</span></div><div class="line" id="file-scenes-js-LC150"><span class="p">});</span></div></pre>
          </td>
        </tr>
      </tbody></table>
    </div>

          </div>
          <div class="gist-meta">
            <a href="https://gist.github.com/darrentorpey/8513544/raw/scenes.js" style="float:right">view raw</a>
            <a href="https://gist.github.com/darrentorpey/8513544#file-scenes-js">scenes.js</a>
            hosted with ❤ by <a href="https://github.com/">GitHub</a>
          </div>
        </div>
</div>


</div>
  
  
  <section class="author-meta">
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Darren Torpey</span></span>

      








  


<time datetime="2013-02-01T12:00:00-05:00" pubdate="" data-updated="true">Feb 1<span>st</span>, 2013</time>
      in 

<span class="categories">
  
    <a class="category" href="http://buildnewgames.com/blog/categories/engines/">Engines</a>
  
</span>

.
    </p>
    
      <div class="sharing">
  
  <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="./An introduction to the Crafty game engine - Build New Games_files/tweet_button.1401325387.html" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-horizontal" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 107px; height: 20px;"></iframe>
  
  
  <div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I0_1402766012713" name="I0_1402766012713" src="./An introduction to the Crafty game engine - Build New Games_files/fastbutton.html" data-gapiattached="true" title="+1"></iframe></div>
  
  
    <div class="fb-like fb_iframe_widget" data-send="true" data-width="350" data-show-faces="false" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=212934732101925&amp;href=http%3A%2F%2Fbuildnewgames.com%2Fintroduction-to-crafty%2F&amp;locale=en_US&amp;sdk=joey&amp;send=true&amp;show_faces=false&amp;width=350"><span style="vertical-align: bottom; width: 350px; height: 20px;"><iframe name="f2a1911e4" width="350px" height="1000px" frameborder="0" allowtransparency="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./An introduction to the Crafty game engine - Build New Games_files/like.html" class="" style="border: none; visibility: visible; width: 350px; height: 20px;"></iframe></span></div>
  
  <a href="http://www.reddit.com/submit" onclick="window.location = &#39;http://www.reddit.com/submit?url=&#39; + encodeURIComponent(window.location); return false"> <img src="./An introduction to the Crafty game engine - Build New Games_files/spreddit7.gif" alt="submit to reddit" border="0"> </a>
  
  <iframe frameborder="no" scrolling="no" height="28px" width="100px" src="./An introduction to the Crafty game engine - Build New Games_files/upvote.html">iframes not supported by your browser</iframe>
  
</div>

    
    <!--
      <p>
      
        <a class="basic-alignment left" href="/astar/" title="Previous Post: A-STAR Pathfinding AI for HTML5 Canvas Games">&laquo; A-STAR Pathfinding AI for HTML5 Canvas Games</a>
      
      
        <a class="basic-alignment right" href="/vector-field-collision-avoidance/" title="Next Post: Vector Field Obstacle Avoidance">Vector Field Obstacle Avoidance &raquo;</a>
      
      </p>
    -->
  </section>

  <section id="comments">
    <h3>Comments</h3>
    <div id="disqus_thread" aria-live="polite"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" tabindex="0" title="Disqus" width="100%" src="about:blank" scrolling="no" horizontalscrolling="no" verticalscrolling="no" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 0px !important;"></iframe></div>
  </section>

  <aside class="related-articles">

    

    
      
        
      
        
          
            
    <h2>related articles</h2>

    <ul>
          
          <li>
            <a href="http://buildnewgames.com/simulating-natural-systems/">Simulating Natural Systems in a Web Browser</a>
            <span class="byline">by Vince Allen</span>
          </li>
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/vector-field-collision-avoidance/">Vector Field Obstacle Avoidance</a>
            <span class="byline">by Alexander Sutherland</span>
          </li>
        
      
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/game-engine-comparison/">JavaScript Game Engine Comparison</a>
            <span class="byline">by Matt Greer</span>
          </li>
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/box2dweb/">Making Games with Box2dWeb</a>
            <span class="byline">by Pascal Rettig</span>
          </li>
        
      
        
      
        
      
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/gamephysics/">How Physics Engines Work</a>
            <span class="byline">by Burak Kanber</span>
          </li>
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/2d-platformer-character-movement/">Deft and intuitive player character movement in a 2D platformer</a>
            <span class="byline">by Mary Rose Cook</span>
          </li>
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/broad-phase-collision-detection/">Broad Phase Collision Detection Using Spatial Partitioning</a>
            <span class="byline">by Andrew Petersen</span>
          </li>
        
      
        
      
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/physics-engines-comparison/">JavaScript Physics Engines Comparison</a>
            <span class="byline">by Chandler Prall</span>
          </li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
    </ul>
      

    

      
        
          
            
    <h2>more stuff</h2>

    <ul>
          
          <li>
            <a href="http://buildnewgames.com/webgl-threejs/">Creating a 3D game with Three.js and WebGL</a>
            <span class="byline">by Nikhil Suresh</span>
          </li>
        
      
        
      
        
          
          <li>
            <a href="http://buildnewgames.com/making-games-fun/">Making Games Fun</a>
            <span class="byline">by Burak Kanber</span>
          </li>
        
      
        
      
        
      
      
    </ul>
      

    <a href="http://buildnewgames.com/">Home</a>
  </aside>
</article>



<script type="text/javascript">
    var disqus_shortname = 'buildnewgames';
    
      
      // var disqus_developer = 1;
      var disqus_identifier = 'http://buildnewgames.com/introduction-to-crafty/';
      var disqus_url = 'http://buildnewgames.com/introduction-to-crafty/';
      var disqus_script = 'embed.js';
    
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./An introduction to the Crafty game engine - Build New Games_files/V80PAcvrynR.html" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./An introduction to the Crafty game engine - Build New Games_files/V80PAcvrynR(1).html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="f199e61328" frameborder="0" allowtransparency="true" scrolling="no" src="./An introduction to the Crafty game engine - Build New Games_files/ping.html" style="display: none;"></iframe></div></div></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


    </section>
  


  

  <footer class="medium">
    Edited and operated by <a href="http://bocoup.com/">Bocoup</a>.
  </footer>

  <footer class="small">
    <p>
      Edited and operated by <a href="http://bocoup.com/">Bocoup</a>
    </p>
  </footer>

  <script type="text/javascript">

    // GA stuffs
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1464992-54']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



<iframe name="oauth2relay415831489" id="oauth2relay415831489" src="./An introduction to the Crafty game engine - Build New Games_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>